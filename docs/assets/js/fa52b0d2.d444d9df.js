"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8510],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),p=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,h=c["".concat(i,".").concat(m)]||c[m]||u[m]||o;return n?a.createElement(h,s(s({ref:t},d),{},{components:n})):a.createElement(h,s({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=c;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var p=2;p<o;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(7294),r=n(6010);const o="tabItem_Ymn6";function s(e){let{children:t,hidden:n,className:s}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o,s),hidden:n},t)}},5488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(7462),r=n(7294),o=n(6010),s=n(2389),l=n(7392),i=n(7094),p=n(2466);const d="tabList__CuJ",u="tabItem_LNqP";function c(e){var t,n;const{lazy:s,block:c,defaultValue:m,values:h,groupId:b,className:g}=e,w=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=h?h:w.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),k=(0,l.l)(f,((e,t)=>e.value===t.value));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const y=null===m?m:null!=(t=null!=m?m:null==(n=w.find((e=>e.props.default)))?void 0:n.props.value)?t:w[0].props.value;if(null!==y&&!f.some((e=>e.value===y)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+y+'" but none of its children has the corresponding value. Available values are: '+f.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:v,setTabGroupChoices:S}=(0,i.U)(),[x,N]=(0,r.useState)(y),P=[],{blockElementScrollPositionUntilNextRender:j}=(0,p.o5)();if(null!=b){const e=v[b];null!=e&&e!==x&&f.some((t=>t.value===e))&&N(e)}const T=e=>{const t=e.currentTarget,n=P.indexOf(t),a=f[n].value;a!==x&&(j(t),N(a),null!=b&&S(b,String(a)))},C=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{var a;const t=P.indexOf(e.currentTarget)+1;n=null!=(a=P[t])?a:P[0];break}case"ArrowLeft":{var r;const t=P.indexOf(e.currentTarget)-1;n=null!=(r=P[t])?r:P[P.length-1];break}}null==(t=n)||t.focus()};return r.createElement("div",{className:(0,o.Z)("tabs-container",d)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":c},g)},f.map((e=>{let{value:t,label:n,attributes:s}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:x===t?0:-1,"aria-selected":x===t,key:t,ref:e=>P.push(e),onKeyDown:C,onFocus:T,onClick:T},s,{className:(0,o.Z)("tabs__item",u,null==s?void 0:s.className,{"tabs__item--active":x===t})}),null!=n?n:t)}))),s?(0,r.cloneElement)(w.filter((e=>e.props.value===x))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},w.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==x})))))}function m(e){const t=(0,s.Z)();return r.createElement(c,(0,a.Z)({key:String(t)},e))}},4715:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>u});var a=n(7462),r=(n(7294),n(3905)),o=n(5488),s=n(5162);const l={title:"Headless Automation"},i=void 0,p={unversionedId:"demos/headless",id:"demos/headless",title:"Headless Automation",description:'Headless automation involves controlling "headless browsers" to access websites',source:"@site/docs/03-demos/42-headless.md",sourceDirName:"03-demos",slug:"/demos/headless",permalink:"/docs/demos/headless",draft:!1,tags:[],version:"current",sidebarPosition:42,frontMatter:{title:"Headless Automation"},sidebar:"tutorialSidebar",previous:{title:"NoSQL Data Stores",permalink:"/docs/demos/nosql"},next:{title:"Typed Arrays and ML",permalink:"/docs/demos/ml"}},d={},u=[{value:"Use Case",id:"use-case",level:2},{value:"Puppeteer",id:"puppeteer",level:2},{value:"Playwright",id:"playwright",level:2},{value:"PhantomJS",id:"phantomjs",level:2}],c={toc:u};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,'Headless automation involves controlling "headless browsers" to access websites\nand submit or download data.  It is also possible to automate browsers using\ncustom browser extensions.'),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"../getting-started/installation/standalone"},"SheetJS standalone script")," can be added to\nany website by inserting a ",(0,r.kt)("inlineCode",{parentName:"p"},"SCRIPT")," tag.  Headless browsers usually provide\nutility functions for running custom snippets in the browser and passing data\nback to the automation script."),(0,r.kt)("h2",{id:"use-case"},"Use Case"),(0,r.kt)("p",null,"This demo focuses on exporting table data to a workbook.  Headless browsers do\nnot generally support passing objects between the browser context and the\nautomation script, so the file data must be generated in the browser context\nand sent back to the automation script for saving in the file system.  Steps:"),(0,r.kt)("p",null,"1) Launch the headless browser and load the target site."),(0,r.kt)("p",null,"2) Add the standalone SheetJS build to the page in a ",(0,r.kt)("inlineCode",{parentName:"p"},"SCRIPT")," tag."),(0,r.kt)("p",null,"3) Add a script to the page (in the browser context) that will:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Make a workbook object from the first table using ",(0,r.kt)("inlineCode",{parentName:"li"},"XLSX.utils.table_to_book")),(0,r.kt)("li",{parentName:"ul"},"Generate the bytes for an XLSB file using ",(0,r.kt)("inlineCode",{parentName:"li"},"XLSX.write")),(0,r.kt)("li",{parentName:"ul"},"Send the bytes back to the automation script")),(0,r.kt)("p",null,"4) When the automation context receives data, save to a file"),(0,r.kt)("p",null,"This demo exports data from ",(0,r.kt)("a",{parentName:"p",href:"https://sheetjs.com/demos/table"},"https://sheetjs.com/demos/table"),"."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"It is also possible to parse files from the browser context, but parsing from\nthe automation context is more efficient and strongly recommended.")),(0,r.kt)("h2",{id:"puppeteer"},"Puppeteer"),(0,r.kt)("p",null,"Puppeteer enables headless Chromium automation for NodeJS.  Releases ship with\nan installer script.  Installation is straightforward:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i https://cdn.sheetjs.com/xlsx-latest/xlsx-latest.tgz puppeteer\n")),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"nodejs",label:"NodeJS",mdxType:"TabItem"},(0,r.kt)("p",null,"Binary strings are the favored data type.  They can be safely passed from the\nbrowser context to the automation script.  NodeJS provides an API to write\nbinary strings to file (",(0,r.kt)("inlineCode",{parentName:"p"},"fs.writeFileSync")," using encoding ",(0,r.kt)("inlineCode",{parentName:"p"},"binary"),")."),(0,r.kt)("p",null,"To run the example, after installing the packages, save the following script to\n",(0,r.kt)("inlineCode",{parentName:"p"},"SheetJSPuppeteer.js")," and run ",(0,r.kt)("inlineCode",{parentName:"p"},"node SheetJSPuppeteer.js"),".  Steps are commented:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="SheetJSPuppeteer.js"',title:'"SheetJSPuppeteer.js"'},'const fs = require("fs");\nconst puppeteer = require(\'puppeteer\');\n(async () => {\n  /* (1) Load the target page */\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  page.on("console", msg => console.log("PAGE LOG:", msg.text()));\n  await page.setViewport({width: 1920, height: 1080});\n  await page.goto(\'https://sheetjs.com/demos/table\');\n\n  /* (2) Load the standalone SheetJS build from the CDN */\n  await page.addScriptTag({ url: \'https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js\' });\n\n  /* (3) Run the snippet in browser and return data */\n  const bin = await page.evaluate(() => {\n    /* NOTE: this function will be evaluated in the browser context.\n       `page`, `fs` and `puppeteer` are not available.\n       `XLSX` will be available thanks to step 2 */\n\n    /* find first table */\n    var table = document.body.getElementsByTagName(\'table\')[0];\n\n    /* call table_to_book on first table */\n    var wb = XLSX.utils.table_to_book(table);\n\n    /* generate XLSB and return binary string */\n    return XLSX.write(wb, {type: "binary", bookType: "xlsb"});\n  });\n\n  /* (4) write data to file */\n  fs.writeFileSync("SheetJSPuppeteer.xlsb", bin, { encoding: "binary" });\n\n  await browser.close();\n})();\n')),(0,r.kt)("p",null,"This script will generate ",(0,r.kt)("inlineCode",{parentName:"p"},"SheetJSPuppeteer.xlsb")," which can be opened in Excel.")),(0,r.kt)(s.Z,{value:"deno",label:"Deno",mdxType:"TabItem"},(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Deno Puppeteer is a fork. It is not officially supported by the Puppeteer team.")),(0,r.kt)("p",null,"Installation is straightforward:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"env PUPPETEER_PRODUCT=chrome deno run -A --unstable https://deno.land/x/puppeteer@14.1.1/install.ts\n")),(0,r.kt)("p",null,"Base64 strings are the favored data type.  They can be safely passed from the\nbrowser context to the automation script.  Deno can decode the Base64 strings\nand write the decoded ",(0,r.kt)("inlineCode",{parentName:"p"},"Uint8Array")," data to file with ",(0,r.kt)("inlineCode",{parentName:"p"},"Deno.writeFileSync")),(0,r.kt)("p",null,"To run the example, after installing the packages, save the following script to\n",(0,r.kt)("inlineCode",{parentName:"p"},"SheetJSPuppeteer.ts")," and run ",(0,r.kt)("inlineCode",{parentName:"p"},"deno run -A --unstable SheetJSPuppeteer.js"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="SheetJSPuppeteer.ts"',title:'"SheetJSPuppeteer.ts"'},'import puppeteer from "https://deno.land/x/puppeteer@14.1.1/mod.ts";\nimport { decode } from "https://deno.land/std/encoding/base64.ts"\n\n/* (1) Load the target page */\nconst browser = await puppeteer.launch();\nconst page = await browser.newPage();\npage.on("console", msg => console.log("PAGE LOG:", msg.text()));\nawait page.setViewport({width: 1920, height: 1080});\nawait page.goto(\'https://sheetjs.com/demos/table\');\n\n/* (2) Load the standalone SheetJS build from the CDN */\nawait page.addScriptTag({ url: \'https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js\' });\n\n/* (3) Run the snippet in browser and return data */\nconst b64 = await page.evaluate(() => {\n  /* NOTE: this function will be evaluated in the browser context.\n     `page`, `fs` and `puppeteer` are not available.\n     `XLSX` will be available thanks to step 2 */\n\n  /* find first table */\n  var table = document.body.getElementsByTagName(\'table\')[0];\n\n  /* call table_to_book on first table */\n  var wb = XLSX.utils.table_to_book(table);\n\n  /* generate XLSB and return binary string */\n  return XLSX.write(wb, {type: "base64", bookType: "xlsb"});\n});\n/* (4) write data to file */\nDeno.writeFileSync("SheetJSPuppeteer.xlsb", decode(b64));\n\nawait browser.close();\n')),(0,r.kt)("p",null,"This script will generate ",(0,r.kt)("inlineCode",{parentName:"p"},"SheetJSPuppeteer.xlsb")," which can be opened in Excel."))),(0,r.kt)("h2",{id:"playwright"},"Playwright"),(0,r.kt)("p",null,"Playwright presents a unified scripting framework for Chromium, WebKit, and\nother browsers.  It draws inspiration from Puppeteer.  In fact, the example\ncode is almost identical!"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i https://cdn.sheetjs.com/xlsx-latest/xlsx-latest.tgz playwright\n")),(0,r.kt)("p",null,"To run the example, after installing the packages, save the following script to\n",(0,r.kt)("inlineCode",{parentName:"p"},"SheetJSPlaywright.js")," and run ",(0,r.kt)("inlineCode",{parentName:"p"},"node SheetJSPlaywright.js"),".  Import divergences\nfrom the Puppeteer example are highlighted below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="SheetJSPlaywright.js"',title:'"SheetJSPlaywright.js"'},'const fs = require("fs");\n// highlight-next-line\nconst { webkit } = require(\'playwright\'); // import desired browser\n(async () => {\n  /* (1) Load the target page */\n  // highlight-next-line\n  const browser = await webkit.launch(); // launch desired browser\n  const page = await browser.newPage();\n  page.on("console", msg => console.log("PAGE LOG:", msg.text()));\n  // highlight-next-line\n  await page.setViewportSize({width: 1920, height: 1080}); // different name :(\n  await page.goto(\'https://sheetjs.com/demos/table\');\n\n  /* (2) Load the standalone SheetJS build from the CDN */\n  await page.addScriptTag({ url: \'https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js\' });\n\n  /* (3) Run the snippet in browser and return data */\n  const bin = await page.evaluate(() => {\n    /* NOTE: this function will be evaluated in the browser context.\n       `page`, `fs` and the browser engine are not available.\n       `XLSX` will be available thanks to step 2 */\n\n    /* find first table */\n    var table = document.body.getElementsByTagName(\'table\')[0];\n\n    /* call table_to_book on first table */\n    var wb = XLSX.utils.table_to_book(table);\n\n    /* generate XLSB and return binary string */\n    return XLSX.write(wb, {type: "binary", bookType: "xlsb"});\n  });\n\n  /* (4) write data to file */\n  fs.writeFileSync("SheetJSPlaywright.xlsb", bin, { encoding: "binary" });\n\n  await browser.close();\n})();\n')),(0,r.kt)("h2",{id:"phantomjs"},"PhantomJS"),(0,r.kt)("p",null,"PhantomJS is a headless web browser powered by WebKit.  Standalone binaries are\navailable at ",(0,r.kt)("a",{parentName:"p",href:"https://phantomjs.org/download.html"},"https://phantomjs.org/download.html")),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"This information is provided for legacy deployments.  PhantomJS development has\nbeen suspended and there are known vulnerabilities, so new projects should use\nalternatives.  For WebKit automation, new projects should use Playwright.")),(0,r.kt)("p",null,"Binary strings are the favored data type.  They can be safely passed from the\nbrowser context to the automation script.  PhantomJS provides an API to write\nbinary strings to file (",(0,r.kt)("inlineCode",{parentName:"p"},"fs.write")," using mode ",(0,r.kt)("inlineCode",{parentName:"p"},"wb"),")."),(0,r.kt)("p",null,"To run the example, save the following script to ",(0,r.kt)("inlineCode",{parentName:"p"},"SheetJSPhantom.js")," in the same\nfolder as ",(0,r.kt)("inlineCode",{parentName:"p"},"phantomjs.exe")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"phantomjs")," and run"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"./phantomjs SheetJSPhantom.js     ## MacOS / Linux\n.\\phantomjs.exe SheetJSPhantom.js ## windows\n")),(0,r.kt)("p",null,"The steps are marked in the comments:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="SheetJSPhantom.js"',title:'"SheetJSPhantom.js"'},'var page = require(\'webpage\').create();\npage.onConsoleMessage = function(msg) { console.log(msg); };\n\n/* (1) Load the target page */\npage.open(\'https://sheetjs.com/demos/table\', function() {\n\n  /* (2) Load the standalone SheetJS build from the CDN */\n  page.includeJs("https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js", function() {\n\n    /* (3) Run the snippet in browser and return data */\n    var bin = page.evaluateJavaScript([ "function(){",\n\n      /* find first table */\n      "var table = document.body.getElementsByTagName(\'table\')[0];",\n\n      /* call table_to_book on first table */\n      "var wb = XLSX.utils.table_to_book(table);",\n\n      /* generate XLSB file and return binary string */\n      "return XLSX.write(wb, {type: \'binary\', bookType: \'xlsb\'});",\n    "}" ].join(""));\n\n    /* (4) write data to file */\n    require("fs").write("SheetJSPhantomJS.xlsb", bin, "wb");\n\n    phantom.exit();\n  });\n});\n')),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"PhantomJS is very finicky and will hang if there are script errors.  It is\nstrongly recommended to add verbose logging and to lint scripts before use.")))}m.isMDXComponent=!0}}]);