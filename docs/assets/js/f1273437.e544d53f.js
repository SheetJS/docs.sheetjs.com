"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7839],{3905:(e,n,r)=>{r.d(n,{Zo:()=>c,kt:()=>f});var t=r(7294);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function i(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=t.createContext({}),d=function(e){var n=t.useContext(s),r=n;return e&&(r="function"==typeof e?e(n):l(l({},n),e)),r},c=function(e){var n=d(e.components);return t.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=d(r),f=a,g=u["".concat(s,".").concat(f)]||u[f]||p[f]||o;return r?t.createElement(g,l(l({ref:n},c),{},{components:r})):t.createElement(g,l({ref:n},c))}));function f(e,n){var r=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=r.length,l=new Array(o);l[0]=u;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var d=2;d<o;d++)l[d]=r[d];return t.createElement.apply(null,l)}return t.createElement.apply(null,r)}u.displayName="MDXCreateElement"},9743:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var t=r(7462),a=(r(7294),r(3905));const o={sidebar_position:2,title:"Troubleshooting",hide_table_of_contents:!0},l=void 0,i={unversionedId:"miscellany/errors",id:"miscellany/errors",title:"Troubleshooting",description:"Here are some common errors and their resolutions.  This is not comprehensive.",source:"@site/docs/09-miscellany/02-errors.md",sourceDirName:"09-miscellany",slug:"/miscellany/errors",permalink:"/docs/miscellany/errors",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Troubleshooting",hide_table_of_contents:!0},sidebar:"tutorialSidebar",previous:{title:"File Formats",permalink:"/docs/miscellany/formats"},next:{title:"Testing",permalink:"/docs/miscellany/testing"}},s={},d=[{value:"Errors",id:"errors",level:2},{value:"SCRIPT5022: DataCloneError",id:"script5022-datacloneerror",level:4},{value:"Object doesn&#39;t support property or method &#39;slice&#39;",id:"object-doesnt-support-property-or-method-slice",level:4},{value:"TypeError: f.substr is not a function",id:"typeerror-fsubstr-is-not-a-function",level:4},{value:"Error: Cannot read property &#39;0&#39; of undefined",id:"error-cannot-read-property-0-of-undefined",level:4},{value:"<code>Unsupported file undefined</code> when reading ArrayBuffer objects",id:"unsupported-file-undefined-when-reading-arraybuffer-objects",level:4},{value:"Data Issues",id:"data-issues",level:2},{value:"CSV and XLS files with Chinese or Japanese characters look garbled",id:"csv-and-xls-files-with-chinese-or-japanese-characters-look-garbled",level:4},{value:"Worksheet only includes one row of data",id:"worksheet-only-includes-one-row-of-data",level:4}],c={toc:d};function p(e){let{components:n,...r}=e;return(0,a.kt)("wrapper",(0,t.Z)({},c,r,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Here are some common errors and their resolutions.  This is not comprehensive.\nThe ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/SheetJS/sheetjs/issues"},"issue tracker")," has a wealth of\ninformation and user-contributed examples."),(0,a.kt)("p",null,"If issues are not covered in the docs or the issue tracker, or if a solution is\nnot discussed in the documentation, we would appreciate a bug report."),(0,a.kt)("admonition",{title:"Special Thanks",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Special thanks to the early adopters and users for discovering and sharing many\nworkarounds and solutions!")),(0,a.kt)("h2",{id:"errors"},"Errors"),(0,a.kt)("h4",{id:"script5022-datacloneerror"},"SCRIPT5022: DataCloneError"),(0,a.kt)("p",null,"IE10 does not properly support Transferables."),(0,a.kt)("h4",{id:"object-doesnt-support-property-or-method-slice"},"Object doesn't support property or method 'slice'"),(0,a.kt)("p",null,"IE does not implement ",(0,a.kt)("inlineCode",{parentName:"p"},"Uint8Array#slice"),". An implementation is included in the\nshim script.  Check ",(0,a.kt)("a",{parentName:"p",href:"../getting-started/installation/standalone#internet-explorer-and-older-browsers"},'the "Standalone" Installation note')),(0,a.kt)("h4",{id:"typeerror-fsubstr-is-not-a-function"},"TypeError: f.substr is not a function"),(0,a.kt)("p",null,"Some Google systems use the ",(0,a.kt)("inlineCode",{parentName:"p"},"base64url")," encoding. ",(0,a.kt)("inlineCode",{parentName:"p"},"base64url")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"base64")," are\ndifferent encodings.  A simple regular expression can translate the data:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'var wb = XLSX.read(b64.replace(/_/g, "/").replace(/-/g, "+"), {type:\'base64\'});\n')),(0,a.kt)("h4",{id:"error-cannot-read-property-0-of-undefined"},"Error: Cannot read property '0' of undefined"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"FileReader#readAsText")," will corrupt binary data including XLSX, XLSB, XLS, and\nother binary spreadsheet files."),(0,a.kt)("p",null,"Applications should use ",(0,a.kt)("inlineCode",{parentName:"p"},"FileReader#readAsArrayBuffer")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"Blob#arrayBuffer"),".\nExamples are included ",(0,a.kt)("a",{parentName:"p",href:"/docs/solutions/input#example-user-submissions"},'in "User Submissions"')),(0,a.kt)("p",null,"Applications specifically targeting legacy browsers like IE10 should use\n",(0,a.kt)("inlineCode",{parentName:"p"},"FileReader#readAsBinaryString")," to read the data and call ",(0,a.kt)("inlineCode",{parentName:"p"},"XLSX.read")," using the\n",(0,a.kt)("inlineCode",{parentName:"p"},"binary")," type."),(0,a.kt)("h4",{id:"unsupported-file-undefined-when-reading-arraybuffer-objects"},(0,a.kt)("inlineCode",{parentName:"h4"},"Unsupported file undefined")," when reading ArrayBuffer objects"),(0,a.kt)("p",null,"Old versions of the library did not automatically detect ",(0,a.kt)("inlineCode",{parentName:"p"},"ArrayBuffer")," objects."),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("b",null,"Workaround")," (click to show)"),(0,a.kt)("admonition",{title:"Legacy workaround",type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"This soltion is not recommended for production deployments.  Native support\nfor ",(0,a.kt)("inlineCode",{parentName:"p"},"ArrayBuffer")," was added in library version ",(0,a.kt)("inlineCode",{parentName:"p"},"0.9.9"),".")),(0,a.kt)("p",null,"After reading data with ",(0,a.kt)("inlineCode",{parentName:"p"},"FileReader#readAsArrayBuffer"),", manually translate to\nbinary string and call ",(0,a.kt)("inlineCode",{parentName:"p"},"XLSX.read")," with type ",(0,a.kt)("inlineCode",{parentName:"p"},'"binary"')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"document.getElementById('file-object').addEventListener(\"change\", function(e) {\n  var files = e.target.files,file;\n  if (!files || files.length == 0) return;\n  file = files[0];\n  var fileReader = new FileReader();\n  fileReader.onload = function (e) {\n    var filename = file.name;\n    // pre-process data\n    var binary = \"\";\n    var bytes = new Uint8Array(e.target.result);\n    var length = bytes.byteLength;\n    for (var i = 0; i < length; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }\n    // call 'xlsx' to read the file\n    var oFile = XLSX.read(binary, {type: 'binary', cellDates:true, cellStyles:true});\n  };\n  fileReader.readAsArrayBuffer(file);\n});\n"))),(0,a.kt)("h2",{id:"data-issues"},"Data Issues"),(0,a.kt)("h4",{id:"csv-and-xls-files-with-chinese-or-japanese-characters-look-garbled"},"CSV and XLS files with Chinese or Japanese characters look garbled"),(0,a.kt)("p",null,"The ESM build, used in tools like Webpack and in Deno, does not include the\ncodepage tables by default.  The ",(0,a.kt)("a",{parentName:"p",href:"/docs/getting-started/installation/frameworks#encoding-support"},'"Frameworks and Bundlers"'),"\nsection explains how to load support."),(0,a.kt)("h4",{id:"worksheet-only-includes-one-row-of-data"},"Worksheet only includes one row of data"),(0,a.kt)("p",null,"Some third-party writer tools will not update the dimensions records in XLSX or\nXLS or XLSB exports.  SheetJS utility functions will skip values not in range."),(0,a.kt)("p",null,"The following helper function will recalculate the range:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function update_sheet_range(ws) {\n  var range = {s:{r:Infinity, c:Infinity},e:{r:0,c:0}};\n  Object.keys(ws).filter(function(x) { return x.charAt(0) != \"!\"; }).map(XLSX.utils.decode_cell).forEach(function(x) {\n    range.s.c = Math.min(range.s.c, x.c); range.s.r = Math.min(range.s.r, x.r);\n    range.e.c = Math.max(range.e.c, x.c); range.e.r = Math.max(range.e.r, x.r);\n  });\n  ws['!ref'] = XLSX.utils.encode_range(range);\n}\n")),(0,a.kt)("details",null,(0,a.kt)("summary",null,(0,a.kt)("b",null,"More Code Snippets")," (click to show) "),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"set_sheet_range")," changes a sheet's range given a general target spec that can include only the start or end cell:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'/* given the old range and a new range spec, produce the new range */\nfunction change_range(old, range) {\n  var oldrng = XLSX.utils.decode_range(old), newrng;\n  if(typeof range == "string") {\n    if(range.charAt(0) == ":") newrng = {e:XLSX.utils.decode_cell(range.substr(1))};\n    else if(range.charAt(range.length - 1) == ":") newrng = {s:XLSX.utils.decode_cell(range.substr(0, range.length - 1))};\n    else newrng = XLSX.utils.decode_range(range);\n  } else newrng = range;\n  if(newrng.s) {\n    if(newrng.s.c != null) oldrng.s.c = newrng.s.c;\n    if(newrng.s.r != null) oldrng.s.r = newrng.s.r;\n  }\n  if(newrng.e) {\n    if(newrng.e.c != null) oldrng.e.c = newrng.e.c;\n    if(newrng.e.r != null) oldrng.e.r = newrng.e.r;\n  }\n\n  return XLSX.utils.encode_range(oldrng);\n}\n\n/* call change_sheet and modify worksheet */\nfunction set_sheet_range(sheet, range) {\n  sheet[\'!ref\'] = change_range(sheet[\'!ref\'], range);\n}\n')),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Adding a cell to a range")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function range_add_cell(range, cell) {\n  var rng = XLSX.utils.decode_range(range);\n  var c = typeof cell == 'string' ? XLSX.utils.decode_cell(cell) : cell;\n  console.log(rng, c);\n  if(rng.s.r > c.r) rng.s.r = c.r;\n  if(rng.s.c > c.c) rng.s.c = c.c;\n\n  if(rng.e.r < c.r) rng.e.r = c.r;\n  if(rng.e.c < c.c) rng.e.c = c.c;\n  return XLSX.utils.encode_range(rng);\n}\nrange_add_cell(\"A1:C3\",\"B2\")\n\nfunction add_to_sheet(sheet, cell) {\n  sheet['!ref'] = range_add_cell(sheet['!ref'], cell);\n}\n"))))}p.isMDXComponent=!0}}]);