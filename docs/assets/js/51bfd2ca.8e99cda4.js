"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9482],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),c=p(n),h=r,m=c["".concat(l,".").concat(h)]||c[h]||u[h]||o;return n?a.createElement(m,s(s({ref:t},d),{},{components:n})):a.createElement(m,s({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var p=2;p<o;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},8753:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const o={sidebar_position:7},s="Headless Automation",i={unversionedId:"demos/headless",id:"demos/headless",title:"Headless Automation",description:'Headless automation involves controlling "headless browsers" to access websites',source:"@site/docs/03-demos/07-headless.md",sourceDirName:"03-demos",slug:"/demos/headless",permalink:"/docs/demos/headless",draft:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"HTTP Network Requests",permalink:"/docs/demos/network"},next:{title:"Typed Arrays and ML",permalink:"/docs/demos/ml"}},l={},p=[{value:"Use Case",id:"use-case",level:2},{value:"Puppeteer",id:"puppeteer",level:2},{value:"Playwright",id:"playwright",level:2},{value:"PhantomJS",id:"phantomjs",level:2}],d={toc:p};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"headless-automation"},"Headless Automation"),(0,r.kt)("p",null,'Headless automation involves controlling "headless browsers" to access websites\nand submit or download data.  It is also possible to automate browsers using\ncustom browser extensions.'),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"../getting-started/installation/standalone"},"SheetJS standalone script")," can be added to\nany website by inserting a ",(0,r.kt)("inlineCode",{parentName:"p"},"SCRIPT")," tag.  Headless browsers usually provide\nutility functions for running custom snippets in the browser and passing data\nback to the automation script."),(0,r.kt)("h2",{id:"use-case"},"Use Case"),(0,r.kt)("p",null,"This demo focuses on exporting table data to a workbook.  Headless browsers do\nnot generally support passing objects between the browser context and the\nautomation script, so the file data must be generated in the browser context\nand sent back to the automation script for saving in the filesystem.  Steps:"),(0,r.kt)("p",null,"1) Launch the headless browser and load the target webpage."),(0,r.kt)("p",null,"2) Add the standalone SheetJS build to the page in a ",(0,r.kt)("inlineCode",{parentName:"p"},"SCRIPT")," tag."),(0,r.kt)("p",null,"3) Add a script to the page (in the browser context) that will:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Make a workbook object from the first table using ",(0,r.kt)("inlineCode",{parentName:"li"},"XLSX.utils.table_to_book")),(0,r.kt)("li",{parentName:"ul"},"Generate the bytes for an XLSB file using ",(0,r.kt)("inlineCode",{parentName:"li"},"XLSX.write")),(0,r.kt)("li",{parentName:"ul"},"Send the bytes back to the automation script")),(0,r.kt)("p",null,"4) When the automation context receives data, save to a file"),(0,r.kt)("p",null,"This demo exports data from ",(0,r.kt)("a",{parentName:"p",href:"https://sheetjs.com/demos/table"},"https://sheetjs.com/demos/table"),"."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"It is also possible to parse files from the browser context, but parsing from\nthe automation context is more performant and strongly recommended.")),(0,r.kt)("h2",{id:"puppeteer"},"Puppeteer"),(0,r.kt)("p",null,"Puppeteer enables headless Chromium automation for NodeJS.  Releases ship with\nan installer script.  Installation is straightforward:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i https://cdn.sheetjs.com/xlsx-latest/xlsx-latest.tgz puppeteer\n")),(0,r.kt)("p",null,"Binary strings are the favored data type.  They can be safely passed from the\nbrowser context to the automation script.  NodeJS provides an API to write\nbinary strings to file (",(0,r.kt)("inlineCode",{parentName:"p"},"fs.writeFileSync")," using encoding ",(0,r.kt)("inlineCode",{parentName:"p"},"binary"),")."),(0,r.kt)("p",null,"To run the example, after installing the packages, save the following script to\n",(0,r.kt)("inlineCode",{parentName:"p"},"SheetJSPuppeteer.js")," and run ",(0,r.kt)("inlineCode",{parentName:"p"},"node SheetJSPuppeteer.js"),".  Steps are commented:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="SheetJSPuppeteer.js"',title:'"SheetJSPuppeteer.js"'},'const fs = require("fs");\nconst puppeteer = require(\'puppeteer\');\n(async () => {\n  /* (1) Load the target page */\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  page.on("console", msg => console.log("PAGE LOG:", msg.text()));\n  await page.setViewport({width: 1920, height: 1080});\n  await page.goto(\'https://sheetjs.com/demos/table\');\n\n  /* (2) Load the standalone SheetJS build from the CDN */\n  await page.addScriptTag({ url: \'https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js\' });\n\n  /* (3) Run the snippet in browser and return data */\n  const bin = await page.evaluate(() => {\n    /* NOTE: this function will be evaluated in the browser context.\n       `page`, `fs` and `puppeteer` are not available.\n       `XLSX` will be available thanks to step 2 */\n\n    /* find first table */\n    var table = document.body.getElementsByTagName(\'table\')[0];\n\n    /* call table_to_book on first table */\n    var wb = XLSX.utils.table_to_book(table);\n\n    /* generate XLSB and return binary string */\n    return XLSX.write(wb, {type: "binary", bookType: "xlsb"});\n  });\n\n  /* (4) write data to file */\n  fs.writeFileSync("SheetJSPuppeteer.xlsb", bin, { encoding: "binary" });\n\n  await browser.close();\n})();\n')),(0,r.kt)("h2",{id:"playwright"},"Playwright"),(0,r.kt)("p",null,"Playwright presents a unified scripting framework for Chromium, WebKit, and\nother browsers.  It draws inspiration from Puppeteer.  In fact, the example\ncode is almost identical!"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i https://cdn.sheetjs.com/xlsx-latest/xlsx-latest.tgz playwright\n")),(0,r.kt)("p",null,"To run the example, after installing the packages, save the following script to\n",(0,r.kt)("inlineCode",{parentName:"p"},"SheetJSPlaywright.js")," and run ",(0,r.kt)("inlineCode",{parentName:"p"},"node SheetJSPlaywright.js"),".  Import divergences\nfrom the Puppeteer example are highlighted below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="SheetJSPlaywright.js"',title:'"SheetJSPlaywright.js"'},'const fs = require("fs");\n// highlight-next-line\nconst { webkit } = require(\'playwright\'); // import desired browser\n(async () => {\n  /* (1) Load the target page */\n  // highlight-next-line\n  const browser = await webkit.launch(); // launch desired browser\n  const page = await browser.newPage();\n  page.on("console", msg => console.log("PAGE LOG:", msg.text()));\n  // highlight-next-line\n  await page.setViewportSize({width: 1920, height: 1080}); // different name :(\n  await page.goto(\'https://sheetjs.com/demos/table\');\n\n  /* (2) Load the standalone SheetJS build from the CDN */\n  await page.addScriptTag({ url: \'https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js\' });\n\n  /* (3) Run the snippet in browser and return data */\n  const bin = await page.evaluate(() => {\n    /* NOTE: this function will be evaluated in the browser context.\n       `page`, `fs` and the browser engine are not available.\n       `XLSX` will be available thanks to step 2 */\n\n    /* find first table */\n    var table = document.body.getElementsByTagName(\'table\')[0];\n\n    /* call table_to_book on first table */\n    var wb = XLSX.utils.table_to_book(table);\n\n    /* generate XLSB and return binary string */\n    return XLSX.write(wb, {type: "binary", bookType: "xlsb"});\n  });\n\n  /* (4) write data to file */\n  fs.writeFileSync("SheetJSPlaywright.xlsb", bin, { encoding: "binary" });\n\n  await browser.close();\n})();\n')),(0,r.kt)("h2",{id:"phantomjs"},"PhantomJS"),(0,r.kt)("p",null,"PhantomJS is a headless web browser powered by WebKit.  Standalone binaries are\navailable at ",(0,r.kt)("a",{parentName:"p",href:"https://phantomjs.org/download.html"},"https://phantomjs.org/download.html")),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"This information is provided for legacy deployments.  PhantomJS development has\nbeen suspended and there are known vulnerabilities, so new projects should use\nalternatives.  For WebKit automation, new projects should use Playwright.")),(0,r.kt)("p",null,"Binary strings are the favored data type.  They can be safely passed from the\nbrowser context to the automation script.  PhantomJS provides an API to write\nbinary strings to file (",(0,r.kt)("inlineCode",{parentName:"p"},"fs.write")," using mode ",(0,r.kt)("inlineCode",{parentName:"p"},"wb"),")."),(0,r.kt)("p",null,"To run the example, save the following script to ",(0,r.kt)("inlineCode",{parentName:"p"},"SheetJSPhantom.js")," in the same\nfolder as ",(0,r.kt)("inlineCode",{parentName:"p"},"phantomjs.exe")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"phantomjs")," and run"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"./phantomjs SheetJSPhantom.js     ## MacOS / Linux\n.\\phantomjs.exe SheetJSPhantom.js ## windows\n")),(0,r.kt)("p",null,"The steps are marked in the comments:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="SheetJSPhantom.js"',title:'"SheetJSPhantom.js"'},'var page = require(\'webpage\').create();\npage.onConsoleMessage = function(msg) { console.log(msg); };\n\n/* (1) Load the target page */\npage.open(\'https://sheetjs.com/demos/table\', function() {\n\n  /* (2) Load the standalone SheetJS build from the CDN */\n  page.includeJs("https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js", function() {\n\n    /* (3) Run the snippet in browser and return data */\n    var bin = page.evaluateJavaScript([ "function(){",\n\n      /* find first table */\n      "var table = document.body.getElementsByTagName(\'table\')[0];",\n\n      /* call table_to_book on first table */\n      "var wb = XLSX.utils.table_to_book(table);",\n\n      /* generate XLSB file and return binary string */\n      "return XLSX.write(wb, {type: \'binary\', bookType: \'xlsb\'});",\n    "}" ].join(""));\n\n    /* (4) write data to file */\n    require("fs").write("SheetJSPhantomJS.xlsb", bin, "wb");\n\n    phantom.exit();\n  });\n});\n')),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"PhantomJS is very finicky and will hang if there are script errors.  It is\nstrongly recommended to add verbose logging and to lint scripts before use.")))}u.isMDXComponent=!0}}]);