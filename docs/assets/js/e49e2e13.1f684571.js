"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9670],{3905:(e,t,n)=>{n.d(t,{Zo:()=>h,kt:()=>u});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=a.createContext({}),d=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},h=function(e){var t=d(e.components);return a.createElement(i.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,i=e.parentName,h=l(e,["components","mdxType","originalType","parentName"]),p=d(n),u=o,m=p["".concat(i,".").concat(u)]||p[u]||c[u]||s;return n?a.createElement(m,r(r({ref:t},h),{},{components:n})):a.createElement(m,r({ref:t},h))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,r=new Array(s);r[0]=p;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var d=2;d<s;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294),o=n(6010);const s="tabItem_Ymn6";function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(s,r),hidden:n},t)}},5488:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(7462),o=n(7294),s=n(6010),r=n(2389),l=n(7392),i=n(7094),d=n(2466);const h="tabList__CuJ",c="tabItem_LNqP";function p(e){var t;const{lazy:n,block:r,defaultValue:p,values:u,groupId:m,className:w}=e,k=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),g=u??k.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),f=(0,l.l)(g,((e,t)=>e.value===t.value));if(f.length>0)throw new Error(`Docusaurus error: Duplicate values "${f.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const b=null===p?p:p??(null==(t=k.find((e=>e.props.default)))?void 0:t.props.value)??k[0].props.value;if(null!==b&&!g.some((e=>e.value===b)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${b}" but none of its children has the corresponding value. Available values are: ${g.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:S,setTabGroupChoices:v}=(0,i.U)(),[y,N]=(0,o.useState)(b),x=[],{blockElementScrollPositionUntilNextRender:j}=(0,d.o5)();if(null!=m){const e=S[m];null!=e&&e!==y&&g.some((t=>t.value===e))&&N(e)}const _=e=>{const t=e.currentTarget,n=x.indexOf(t),a=g[n].value;a!==y&&(j(t),N(a),null!=m&&v(m,String(a)))},C=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{const t=x.indexOf(e.currentTarget)+1;n=x[t]??x[0];break}case"ArrowLeft":{const t=x.indexOf(e.currentTarget)-1;n=x[t]??x[x.length-1];break}}null==(t=n)||t.focus()};return o.createElement("div",{className:(0,s.Z)("tabs-container",h)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":r},w)},g.map((e=>{let{value:t,label:n,attributes:r}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:y===t?0:-1,"aria-selected":y===t,key:t,ref:e=>x.push(e),onKeyDown:C,onFocus:_,onClick:_},r,{className:(0,s.Z)("tabs__item",c,null==r?void 0:r.className,{"tabs__item--active":y===t})}),n??t)}))),n?(0,o.cloneElement)(k.filter((e=>e.props.value===y))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},k.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==y})))))}function u(e){const t=(0,r.Z)();return o.createElement(p,(0,a.Z)({key:String(t)},e))}},9422:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>d,toc:()=>c});var a=n(7462),o=(n(7294),n(3905)),s=n(5488),r=n(5162);const l={title:"Google Sheets"},i=void 0,d={unversionedId:"demos/gsheet",id:"demos/gsheet",title:"Google Sheets",description:"",source:"@site/docs/03-demos/25-gsheet.md",sourceDirName:"03-demos",slug:"/demos/gsheet",permalink:"/docs/demos/gsheet",draft:!1,tags:[],version:"current",sidebarPosition:25,frontMatter:{title:"Google Sheets"},sidebar:"tutorialSidebar",previous:{title:"Adobe Apps",permalink:"/docs/demos/extendscript"},next:{title:"Excel JavaScript API",permalink:"/docs/demos/excelapi"}},h={},c=[{value:"Initial Configuration",id:"initial-configuration",level:2},{value:"Export Document Data",id:"export-document-data",level:2},{value:"Convert a Single Sheet",id:"convert-a-single-sheet",level:3},{value:"Convert a Workbook",id:"convert-a-workbook",level:3},{value:"Update Document Data",id:"update-document-data",level:2},{value:"Clear the Document",id:"clear-the-document",level:3},{value:"Update First Sheet",id:"update-first-sheet",level:3},{value:"Update Sheet Name",id:"update-sheet-name",level:4},{value:"Update Sheet Data",id:"update-sheet-data",level:4},{value:"Append Remaining Worksheets",id:"append-remaining-worksheets",level:3},{value:"Add a New Worksheet",id:"add-a-new-worksheet",level:4},{value:"Update Worksheet Data",id:"update-worksheet-data",level:4},{value:"Raw File Exports",id:"raw-file-exports",level:2}],p={toc:c};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This demo uses ",(0,o.kt)("a",{parentName:"p",href:"https://theoephraim.github.io/node-google-spreadsheet"},(0,o.kt)("inlineCode",{parentName:"a"},"node-google-spreadsheet")),"\nto interact with Google Sheets v4 API."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Google Sheets deprecates APIs quickly and there is no guarantee that the\nreferenced API version will be available in the future.")),(0,o.kt)("h2",{id:"initial-configuration"},"Initial Configuration"),(0,o.kt)("p",null,"Install the dependencies:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm i https://cdn.sheetjs.com/xlsx-latest/xlsx-latest.tgz google-spreadsheet@3.3.0\n")),(0,o.kt)("p",null,"The library README has a ",(0,o.kt)("a",{parentName:"p",href:"https://theoephraim.github.io/node-google-spreadsheet/#/getting-started/authentication"},"guide"),"\nfor configuring a service worker with write access to the document.  Following\nthe service worker guide, the JSON key should be saved to ",(0,o.kt)("inlineCode",{parentName:"p"},"key.json"),"."),(0,o.kt)("p",null,"The following helper function attempts to authenticate and access the specified\nsheet by ID.  The code should be copied and saved to ",(0,o.kt)("inlineCode",{parentName:"p"},"common.js"),":"),(0,o.kt)("details",null,(0,o.kt)("summary",null,(0,o.kt)("b",null,"Code")," (click to show)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=common.js",title:"common.js"},"const fs = require(\"fs\");\nconst { GoogleSpreadsheet } = require('google-spreadsheet');\n\nmodule.exports = async(ID) => {\n  /* get credentials */\n  const creds = JSON.parse(fs.readFileSync('key.json'));\n\n  /* initialize sheet and authenticate */\n  const doc = new GoogleSpreadsheet(ID);\n  await doc.useServiceAccountAuth(creds);\n  await doc.loadInfo();\n  return doc;\n}\n"))),(0,o.kt)("h2",{id:"export-document-data"},"Export Document Data"),(0,o.kt)("p",null,"The goal is to create an XLSB export from a Google Sheet.  Google Sheets does\nnot natively support the XLSB format.  SheetJS fills the gap."),(0,o.kt)("details",null,(0,o.kt)("summary",null,(0,o.kt)("b",null,"How to run locally")," (click to show)"),(0,o.kt)("p",null,"0) Follow the ",(0,o.kt)("a",{parentName:"p",href:"https://theoephraim.github.io/node-google-spreadsheet/#/getting-started/authentication"},"Authentication and Service Account"),"\ninstructions.  At the end, you should have"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Created a project and enabled the Sheets API"),(0,o.kt)("li",{parentName:"ul"},"Created a service account with a JSON key")),(0,o.kt)("p",null,"Move the generated JSON key to ",(0,o.kt)("inlineCode",{parentName:"p"},"key.json")," in your project folder."),(0,o.kt)("p",null,'1) Create a new Google Sheet and share with the generated service account.  It\nshould be granted the "Editor" role'),(0,o.kt)("p",null,"2) Install the dependencies:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"npm i https://cdn.sheetjs.com/xlsx-latest/xlsx-latest.tgz google-spreadsheet@3.3.0\n")),(0,o.kt)("p",null,"2) Save the following snippet to ",(0,o.kt)("inlineCode",{parentName:"p"},"common.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=common.js",title:"common.js"},"const fs = require(\"fs\");\nconst { GoogleSpreadsheet } = require('google-spreadsheet');\n\nmodule.exports = async(ID) => {\n  /* get credentials */\n  const creds = JSON.parse(fs.readFileSync('key.json'));\n\n  /* initialize sheet and authenticate */\n  const doc = new GoogleSpreadsheet(ID);\n  await doc.useServiceAccountAuth(creds);\n  await doc.loadInfo();\n  return doc;\n}\n")),(0,o.kt)("p",null,"3) Save the following snippet to ",(0,o.kt)("inlineCode",{parentName:"p"},"pull.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=pull.js",title:"pull.js"},'const XLSX = require("xlsx");\n\n/* create a blank workbook */\nconst wb = XLSX.utils.book_new();\n\nconst init = require("./common");\nconst ID = "<google sheet ID>";\n\n(async() => {\n\n  const doc = await init(ID);\n\n  for(let i = 0; i < doc.sheetsByIndex.length; ++i) {\n    const sheet = doc.sheetsByIndex[i];\n    const name = sheet.title;\n\n    /* get the header and data rows */\n    await sheet.loadHeaderRow();\n    const header = sheet.headerValues;\n    const rows = await sheet.getRows();\n    const aoa = [header].concat(rows.map(r => r._rawData));\n\n    /* generate a SheetJS Worksheet */\n    const ws = XLSX.utils.aoa_to_sheet(aoa);\n\n    /* add to workbook */\n    XLSX.utils.book_append_sheet(wb, ws, name);\n  }\n\n  /* write to SheetJS.xlsb */\n  XLSX.writeFile(wb, "SheetJS.xlsb");\n\n})();\n')),(0,o.kt)("p",null,"4) Replace ",(0,o.kt)("inlineCode",{parentName:"p"},"<google sheet ID>")," with the ID of the actual document."),(0,o.kt)("p",null,"5) Run ",(0,o.kt)("inlineCode",{parentName:"p"},"node pull.js")," once. It will create ",(0,o.kt)("inlineCode",{parentName:"p"},"SheetJS.xlsb"),"."),(0,o.kt)("p",null,"6) Open ",(0,o.kt)("inlineCode",{parentName:"p"},"SheetJS.xlsb")," and confirm the contents are the same as Google Sheets."),(0,o.kt)("p",null,"7) Change some cells in the Google Sheets Document."),(0,o.kt)("p",null,"8) Run ",(0,o.kt)("inlineCode",{parentName:"p"},"node pull.js")," again and reopen ",(0,o.kt)("inlineCode",{parentName:"p"},"SheetJS.xlsb")," to confirm value changes.")),(0,o.kt)("h3",{id:"convert-a-single-sheet"},"Convert a Single Sheet"),(0,o.kt)("p",null,"The idea is to extract the raw data from the Google Sheet headers and combine\nwith the raw data rows to produce a large array of arrays."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"async function wb_append_sheet(sheet, name, wb) {\n  /* get the header and data rows */\n  await sheet.loadHeaderRow();\n  const header = sheet.headerValues;\n  const rows = await sheet.getRows();\n\n  /* construct the array of arrays */\n  const aoa = [header].concat(rows.map(r => r._rawData));\n\n  /* generate a SheetJS Worksheet */\n  const ws = XLSX.utils.aoa_to_sheet(aoa);\n\n  /* add to workbook */\n  XLSX.utils.book_append_sheet(wb, ws, name);\n}\n")),(0,o.kt)("h3",{id:"convert-a-workbook"},"Convert a Workbook"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"doc.sheetsByIndex")," is an array of worksheets in the Google Sheet Document.  By\nlooping across the sheets, the entire workbook can be written:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"async function doc_to_wb(doc) {\n  /* Create a new workbook object */\n  const wb = XLSX.utils.book_new();\n\n  /* Loop across the Document sheets */\n  for(let i = 0; i < doc.sheetsByIndex.length; ++i) {\n    const sheet = doc.sheetsByIndex[i];\n    /* Get the worksheet name */\n    const name = sheet.title;\n\n    /* Add sheet to workbook */\n    await add_sheet_to_wb(sheet, name, wb);\n  }\n\n  return wb;\n}\n")),(0,o.kt)("h2",{id:"update-document-data"},"Update Document Data"),(0,o.kt)("p",null,"The goal is to refresh a Google Sheet based on a local file."),(0,o.kt)("details",null,(0,o.kt)("summary",null,(0,o.kt)("b",null,"How to run locally")," (click to show)"),(0,o.kt)("p",null,"0) Follow the ",(0,o.kt)("a",{parentName:"p",href:"https://theoephraim.github.io/node-google-spreadsheet/#/getting-started/authentication"},"Authentication and Service Account"),"\ninstructions.  At the end, you should have"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Created a project and enabled the Sheets API"),(0,o.kt)("li",{parentName:"ul"},"Created a service account with a JSON key")),(0,o.kt)("p",null,"Move the generated JSON key to ",(0,o.kt)("inlineCode",{parentName:"p"},"key.json")," in your project folder."),(0,o.kt)("p",null,'1) Create a new Google Sheet and share with the generated service account.  It\nshould be granted the "Editor" role'),(0,o.kt)("p",null,"2) Install the dependencies:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"npm i https://cdn.sheetjs.com/xlsx-latest/xlsx-latest.tgz google-spreadsheet@3.3.0\n")),(0,o.kt)("p",null,"2) Save the following snippet to ",(0,o.kt)("inlineCode",{parentName:"p"},"common.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=common.js",title:"common.js"},"const fs = require(\"fs\");\nconst { GoogleSpreadsheet } = require('google-spreadsheet');\n\nmodule.exports = async(ID) => {\n  /* get credentials */\n  const creds = JSON.parse(fs.readFileSync('key.json'));\n\n  /* initialize sheet and authenticate */\n  const doc = new GoogleSpreadsheet(ID);\n  await doc.useServiceAccountAuth(creds);\n  await doc.loadInfo();\n  return doc;\n}\n")),(0,o.kt)("p",null,"3) Save the following snippet to ",(0,o.kt)("inlineCode",{parentName:"p"},"push.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=push.js",title:"push.js"},'const XLSX = require("xlsx");\nconst fs = require("fs");\n/* create dummy worksheet if `sheetjs.xlsx` does not exist */\nif(!fs.existsSync("sheetjs.xlsx")) {\n  const wb = XLSX.utils.book_new();\n  const ws1 = XLSX.utils.aoa_to_sheet([["a","b","c"],[1,2,3]]); XLSX.utils.book_append_sheet(wb, ws1, "Sheet1");\n  const ws2 = XLSX.utils.aoa_to_sheet([["a","b","c"],[4,5,6]]); XLSX.utils.book_append_sheet(wb, ws2, "Sheet2");\n  XLSX.writeFile(wb, "sheetjs.xlsx");\n}\n/* read and parse sheetjs.xlsx */\nconst wb = XLSX.readFile("sheetjs.xlsx");\n\nconst init = require("./common");\nconst ID = "<google sheet ID>";\n\n(async() => {\n\n  const doc = await init(ID);\n\n  /* clear workbook */\n  {\n    /* delete all sheets after the first sheet */\n    const old_sheets = doc.sheetsByIndex;\n    for(let i = 1; i < old_sheets.length; ++i) {\n      await old_sheets[i].delete();\n    }\n    /* clear first worksheet */\n    old_sheets[0].clear();\n  }\n\n  /* write worksheets */\n  {\n    const name = wb.SheetNames[0];\n    const ws = wb.Sheets[name];\n    /* first worksheet already exists */\n    const sheet = doc.sheetsByIndex[0];\n\n    /* update worksheet name */\n    await sheet.updateProperties({title: name});\n\n    /* generate array of arrays from the first worksheet */\n    const aoa = XLSX.utils.sheet_to_json(ws, {header: 1});\n\n    /* set document header row to first row of the AOA */\n    await sheet.setHeaderRow(aoa[0])\n\n    /* add the remaining rows */\n    await sheet.addRows(aoa.slice(1));\n\n    /* the other worksheets must be created manually */\n    for(let i = 1; i < wb.SheetNames.length; ++i) {\n      const name = wb.SheetNames[i];\n      const ws = wb.Sheets[name];\n\n      const sheet = await doc.addSheet({title: name});\n      const aoa = XLSX.utils.sheet_to_json(ws, {header: 1});\n      await sheet.setHeaderRow(aoa[0])\n      await sheet.addRows(aoa.slice(1));\n    }\n  }\n\n})();\n')),(0,o.kt)("p",null,"4) Replace ",(0,o.kt)("inlineCode",{parentName:"p"},"<google sheet ID>")," with the ID of the actual document."),(0,o.kt)("p",null,"5) Run ",(0,o.kt)("inlineCode",{parentName:"p"},"node push.js")," once. It will create ",(0,o.kt)("inlineCode",{parentName:"p"},"sheetjs.xlsx")," and update the sheet."),(0,o.kt)("p",null,"6) Edit ",(0,o.kt)("inlineCode",{parentName:"p"},"sheetjs.xlsx")," with some new data"),(0,o.kt)("p",null,"7) Run ",(0,o.kt)("inlineCode",{parentName:"p"},"node push.js")," again and watch the Google Sheet update!")),(0,o.kt)("h3",{id:"clear-the-document"},"Clear the Document"),(0,o.kt)("p",null,"Google Sheets does not allow users to delete every worksheet.  This function\ndeletes every worksheet after the first, then clears the first worksheet:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"/* clear google sheets doc */\nasync function doc_clear(doc) {\n  /* delete all sheets after the first sheet */\n  const old_sheets = doc.sheetsByIndex;\n  for(let i = 1; i < old_sheets.length; ++i) await old_sheets[i].delete();\n\n  /* clear first worksheet */\n  old_sheets[0].clear();\n}\n")),(0,o.kt)("h3",{id:"update-first-sheet"},"Update First Sheet"),(0,o.kt)("p",null,'There are two steps: "update worksheet name" and "update worksheet data":'),(0,o.kt)("h4",{id:"update-sheet-name"},"Update Sheet Name"),(0,o.kt)("p",null,"The worksheet name is assigned by using the ",(0,o.kt)("inlineCode",{parentName:"p"},"updateProperties")," method.  The\ndesired sheet name is the name of the first worksheet from the file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"async function doc_update_first_sheet_name(doc, wb) {\n  /* get first worksheet name */\n  const wsname = wb.SheetNames[0];\n\n  /* get first gsheet */\n  const sheet = doc.sheetsByIndex[0];\n\n  /* update worksheet name */\n  await sheet.updateProperties({title: wsname});\n}\n")),(0,o.kt)("h4",{id:"update-sheet-data"},"Update Sheet Data"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"sheet.addRows")," reads an Array of Arrays of values. ",(0,o.kt)("inlineCode",{parentName:"p"},"XLSX.utils.sheet_to_json"),"\ncan generate this exact shape with the option ",(0,o.kt)("inlineCode",{parentName:"p"},"header: 1"),'.  Unfortunately\nGoogle Sheets requires at least one "Header Row".  This can be implemented by\nconverting the entire worksheet to an Array of Arrays and setting the header\nrow to the first row of the result:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"async function doc_update_first_sheet_data(doc, wb) {\n  /* get first worksheet */\n  const ws = wb.Sheets[wb.SheetNames[0]];\n  /* generate array of arrays from the first worksheet */\n  const aoa = XLSX.utils.sheet_to_json(ws, {header: 1});\n\n  /* get first gsheet */\n  const sheet = doc.sheetsByIndex[0];\n  /* set document header row to first row of the AOA */\n  await sheet.setHeaderRow(aoa[0]);\n\n  /* add the remaining rows */\n  await sheet.addRows(aoa.slice(1));\n}\n")),(0,o.kt)("h3",{id:"append-remaining-worksheets"},"Append Remaining Worksheets"),(0,o.kt)("p",null,"Each name in the SheetJS Workbook ",(0,o.kt)("inlineCode",{parentName:"p"},"SheetNames")," array maps to a worksheet.  The\nlist of names not including the first sheet is ",(0,o.kt)("inlineCode",{parentName:"p"},"wb.SheetNames.slice(1)"),"."),(0,o.kt)("p",null,'There are two steps for each sheet: "create new sheet" and "load data".'),(0,o.kt)("p",null,"Due to JavaScript ",(0,o.kt)("inlineCode",{parentName:"p"},"async")," idiosyncrasies, a plain ",(0,o.kt)("inlineCode",{parentName:"p"},"for")," loop must be used:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"async function doc_append_remaining_sheets(doc, wb) {\n  const names = wb.SheetNames.slice(1);\n\n  /* loop across names */\n  for(let i = 0; i < names.length; ++i) {\n    /* wb.SheetNames[i] is the sheet name */\n    const name = wb.SheetNames[i];\n    /* wb.Sheets[name] is the worksheet object */\n    const ws = wb.Sheets[name];\n\n    /* create new google sheet */\n    const sheet = await doc_add_new_sheet(doc, name);\n    /* load sheet with data */\n    await sheet_load_from_ws(sheet, ws);\n  }\n}\n")),(0,o.kt)("h4",{id:"add-a-new-worksheet"},"Add a New Worksheet"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"doc.addSheet")," accepts a properties object that includes the worksheet name:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"async function doc_add_new_sheet(doc, name) {\n  return await doc.addSheet({title: name});\n}\n")),(0,o.kt)("p",null,"This creates a new worksheet, sets the tab name, and returns a reference to the\ncreated worksheet."),(0,o.kt)("h4",{id:"update-worksheet-data"},"Update Worksheet Data"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"async function sheet_load_from_ws(sheet, ws) {\n  /* generate array of arrays from the first worksheet */\n  const aoa = XLSX.utils.sheet_to_json(ws, {header: 1});\n\n  /* set document header row to first row of the AOA */\n  await sheet.setHeaderRow(aoa[0]);\n\n  /* add the remaining rows */\n  await sheet.addRows(aoa.slice(1));\n}\n")),(0,o.kt)("h2",{id:"raw-file-exports"},"Raw File Exports"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"node-google-spreadsheet")," can download the XLSX or ODS export of the document.\nThe functions return NodeJS ",(0,o.kt)("inlineCode",{parentName:"p"},"Buffer")," data that can be parsed using SheetJS."),(0,o.kt)("p",null,"This example prints the worksheet names and CSV exports of each sheet."),(0,o.kt)(s.Z,{mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"xlsx",label:"XLSX",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const XLSX = require("xlsx");\n\n(async() => {\n  /* Connect to Google Sheet */\n  const ID = "<google sheet id>";\n  const doc = await require("./common")(ID);\n\n  /* Get file export */\n  // highlight-next-line\n  const buf = await doc.downloadAsXLSX();\n\n  /* Parse with SheetJS */\n  const wb = XLSX.read(buf);\n\n  /* Loop over the worksheet names */\n  wb.SheetNames.forEach(name => {\n    /* Print the name to the console */\n    console.log(name);\n\n    /* Get the corresponding worksheet object */\n    const sheet = wb.Sheets[name];\n\n    /* Print a CSV export of the worksheet */\n    console.log(XLSX.utils.sheet_to_csv(sheet));\n  });\n})();\n'))),(0,o.kt)(r.Z,{value:"ods",label:"ODS",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const XLSX = require("xlsx");\n\n(async() => {\n  /* Connect to Google Sheet */\n  const ID = "<google sheet id>";\n  const doc = await require("./common")(ID);\n\n  /* Get file export */\n  // highlight-next-line\n  const buf = await doc.downloadAsODS();\n\n  /* Parse with SheetJS */\n  const wb = XLSX.read(buf);\n\n  /* Loop over the worksheet names */\n  wb.SheetNames.forEach(name => {\n    /* Print the name to the console */\n    console.log(name);\n\n    /* Get the corresponding worksheet object */\n    const sheet = wb.Sheets[name];\n\n    /* Print a CSV export of the worksheet */\n    console.log(XLSX.utils.sheet_to_csv(sheet));\n  });\n})();\n')))))}u.isMDXComponent=!0}}]);