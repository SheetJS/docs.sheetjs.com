"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7029],{9613:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(9496);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),p=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,h=c["".concat(i,".").concat(m)]||c[m]||u[m]||s;return n?a.createElement(h,o(o({ref:t},d),{},{components:n})):a.createElement(h,o({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=c;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<s;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},3486:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return i},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return u}});var a=n(2848),r=n(9213),s=(n(9496),n(9613)),o=["components"],l={sidebar_position:6,title:"HTTP Network Requests"},i="XHR and fetch",p={unversionedId:"demos/network",id:"demos/network",title:"HTTP Network Requests",description:"XMLHttpRequest and fetch browser APIs enable binary data transfer between",source:"@site/docs/03-demos/06-network.mdx",sourceDirName:"03-demos",slug:"/demos/network",permalink:"/docs/demos/network",draft:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,title:"HTTP Network Requests"},sidebar:"tutorialSidebar",previous:{title:"Google Sheets",permalink:"/docs/demos/gsheet"},next:{title:"Headless Automation",permalink:"/docs/demos/headless"}},d={},u=[{value:"Downloading Binary Data",id:"downloading-binary-data",level:2},{value:"Uploading Binary Data",id:"uploading-binary-data",level:2},{value:"Browser Demos",id:"browser-demos",level:2},{value:"XMLHttpRequest",id:"xmlhttprequest",level:3},{value:"fetch",id:"fetch",level:3},{value:"Wrapper Libraries",id:"wrapper-libraries",level:3},{value:"axios",id:"axios",level:4},{value:"superagent",id:"superagent",level:4},{value:"NodeJS Demos",id:"nodejs-demos",level:2},{value:"request",id:"request",level:3}],c={toc:u};function m(e){var t=e.components,n=(0,r.Z)(e,o);return(0,s.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"xhr-and-fetch"},"XHR and fetch"),(0,s.kt)("head",null,(0,s.kt)("script",{src:"https://unpkg.com/axios/dist/axios.min.js"}),(0,s.kt)("script",{src:"https://unpkg.com/superagent@7.1.1/dist/superagent.min.js"})),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"XMLHttpRequest")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"fetch")," browser APIs enable binary data transfer between\nweb browser clients and web servers.  Since this library works in web browsers,\nserver conversion work can be offloaded to the client!  This demo shows a few\ncommon scenarios involving browser APIs and popular wrapper libraries."),(0,s.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Third-Party Hosts and Binary Data")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"Some services like AWS will corrupt raw binary uploads / downloads by encoding\nrequests and responses in UTF-8.  Typically, these services have options for\ndisabling this behavior."),(0,s.kt)("p",{parentName:"div"},'For AWS, in the "Binary Media Types" section of the API Gateway console, the\nfollowing types should be added to ensure smooth uploads and downloads:'),(0,s.kt)("ul",{parentName:"div"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},'"multipart/form-data"')," (for Lambda functions to receive files from clients)"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},'"application/vnd.ms-excel"')," (for Lambda functions to send files to clients)")))),(0,s.kt)("h2",{id:"downloading-binary-data"},"Downloading Binary Data"),(0,s.kt)("p",null,"Most interesting spreadsheet files are binary data that contain byte sequences\nthat represent invalid UTF-8 characters."),(0,s.kt)("p",null,"The APIs generally have a way to control the interpretation of the downloaded\ndata.  The ",(0,s.kt)("inlineCode",{parentName:"p"},"arraybuffer")," response type usually forces the data to be presented\nas a pure ",(0,s.kt)("inlineCode",{parentName:"p"},"ArrayBuffer")," which can be parsed directly with ",(0,s.kt)("inlineCode",{parentName:"p"},"XLSX.read"),"."),(0,s.kt)("p",null,"For example, with ",(0,s.kt)("inlineCode",{parentName:"p"},"fetch"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'const res = await fetch("https://sheetjs.com/pres.numbers");\nconst ab = await res.arrayBuffer(); // recover data as ArrayBuffer\n\nconst wb = XLSX.read(ab);\n')),(0,s.kt)("h2",{id:"uploading-binary-data"},"Uploading Binary Data"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"FormData")," objects can hold ",(0,s.kt)("inlineCode",{parentName:"p"},"File")," blobs generated from ",(0,s.kt)("inlineCode",{parentName:"p"},"XLSX.write"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"/* generate XLSX file bytes */\nvar data = XLSX.write(workbook, {bookType: 'xlsx', type: 'array'});\n\n/* build FormData with the generated file */\nvar fdata = new FormData();\nfdata.append('data', new File([data], 'sheetjs.xlsx'));\n// field name ^^^^           file name ^^^^^^^^^^^^\n")),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"FormData")," object can be passed along to the POST request.  For example:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'var req = new XMLHttpRequest();\nreq.open("POST", "/upload", true);\nreq.send(fdata);\n')),(0,s.kt)("h2",{id:"browser-demos"},"Browser Demos"),(0,s.kt)("p",null,"The included demos focus on an editable table.  There are two separate flows:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"When the page is accessed, the browser will attempt to download ",(0,s.kt)("a",{parentName:"p",href:"https://sheetjs.com/pres.numbers"},"https://sheetjs.com/pres.numbers"),"\nand read the workbook.  The old table will be replaced with an editable table\nwhose contents match the first worksheet.  The table is generated using the\n",(0,s.kt)("inlineCode",{parentName:"p"},"sheet_to_html")," utility with ",(0,s.kt)("inlineCode",{parentName:"p"},"editable:true")," option")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"When the upload button is clicked, the browser will generate a new worksheet\nusing ",(0,s.kt)("inlineCode",{parentName:"p"},"table_to_book")," and build up a new workbook.  It will then attempt to\ngenerate a file, upload it to ",(0,s.kt)("a",{parentName:"p",href:"https://s2c.sheetjs.com"},"https://s2c.sheetjs.com")," and show the response."))),(0,s.kt)("h3",{id:"xmlhttprequest"},"XMLHttpRequest"),(0,s.kt)("p",null,"For downloading data, the ",(0,s.kt)("inlineCode",{parentName:"p"},"arraybuffer")," response type generates an ",(0,s.kt)("inlineCode",{parentName:"p"},"ArrayBuffer"),"\nthat can be viewed as an ",(0,s.kt)("inlineCode",{parentName:"p"},"Uint8Array")," and fed to ",(0,s.kt)("inlineCode",{parentName:"p"},"XLSX.read")," using ",(0,s.kt)("inlineCode",{parentName:"p"},"array")," type:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'/* set up an async GET request */\nvar req = new XMLHttpRequest();\nreq.open("GET", url, true);\nreq.responseType = "arraybuffer";\n\nreq.onload = function(e) {\n  /* parse the data when it is received */\n  var data = new Uint8Array(req.response);\n  var workbook = XLSX.read(data, {type:"array"});\n  /* DO SOMETHING WITH workbook HERE */\n};\nreq.send();\n')),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("b",null,"Live Download demo")," (click to show)"),(0,s.kt)("p",null,"This demo uses ",(0,s.kt)("inlineCode",{parentName:"p"},"XMLHttpRequest")," to download ",(0,s.kt)("a",{parentName:"p",href:"https://sheetjs.com/pres.numbers"},"https://sheetjs.com/pres.numbers"),"\nand show the data in an HTML table."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live",live:!0},'function SheetJSXHRDL() {\n  const [html, setHTML] = React.useState("");\n\n  /* Fetch and update HTML */\n  React.useEffect(async() => {\n    /* Fetch file */\n    const req = new XMLHttpRequest();\n    req.open("GET", "https://sheetjs.com/pres.numbers", true);\n    req.responseType = "arraybuffer";\n    req.onload = e => {\n      /* Parse file */\n      const wb = XLSX.read(new Uint8Array(req.response));\n      const ws = wb.Sheets[wb.SheetNames[0]];\n\n      /* Generate HTML */\n      setHTML(XLSX.utils.sheet_to_html(ws));\n    };\n    req.send();\n  }, []);\n\n  return (<div dangerouslySetInnerHTML={{__html: html}}/>);\n}\n'))),(0,s.kt)("p",null,"For uploading data, this demo populates a ",(0,s.kt)("inlineCode",{parentName:"p"},"FormData")," object with an ArrayBuffer\ngenerated with the ",(0,s.kt)("inlineCode",{parentName:"p"},"array")," output type:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"/* generate XLSX as array buffer */\nvar data = XLSX.write(workbook, {bookType: 'xlsx', type: 'array'});\n\n/* build FormData with the generated file */\nvar fd = new FormData();\nfd.append('data', new File([data], 'sheetjs.xlsx'));\n\n/* send data */\nvar req = new XMLHttpRequest();\nreq.open(\"POST\", url, true);\nreq.send(fd);\n")),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("b",null,"Live Upload demo")," (click to show)"),(0,s.kt)("p",null,"This demo uses ",(0,s.kt)("inlineCode",{parentName:"p"},"XMLHttpRequest")," to upload data to ",(0,s.kt)("a",{parentName:"p",href:"https://s2c.sheetjs.com"},"https://s2c.sheetjs.com"),".  It\nwill parse the workbook and return an HTML table."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live",live:!0},'function SheetJSXHRUL() {\n  const [html, setHTML] = React.useState("");\n  const [sz, setSz] = React.useState(0);\n  const csv = "a,b,c\\n1,2,3";\n  /* Fetch and update HTML */\n  const xport = React.useCallback(async() => {\n    /* Make Workbook from CSV */\n    const wb = XLSX.read(csv, { type: "string" });\n\n    /* Make FormData */\n    const data = XLSX.write(wb, {bookType: \'xlsx\', type: \'array\'});\n    setSz(data.length || data.byteLength);\n    const fdata = new FormData();\n    fdata.append(\'file\', new File([data], \'sheetjs.xlsx\'));\n\n    /* Upload */\n    const url = "https://s2c.sheetjs.com";\n    const req = new XMLHttpRequest();\n    req.open("POST", url, true);\n    req.onload = (e) => setHTML(req.responseText);\n    req.send(fdata);\n  });\n\n  return (<pre>\n    <b>CSV Data</b>\n    <div>{csv}</div>\n    {sz ? (<>\n      <b>Generated file size: {sz} bytes</b>\n      <div dangerouslySetInnerHTML={{__html: html}}/>\n    </>) : (<button onClick={xport}><b>Export and Upload!</b></button>)}\n  </pre>);\n}\n'))),(0,s.kt)("h3",{id:"fetch"},"fetch"),(0,s.kt)("p",null,"For downloading data, ",(0,s.kt)("inlineCode",{parentName:"p"},"Response#arrayBuffer")," resolves to an ",(0,s.kt)("inlineCode",{parentName:"p"},"ArrayBuffer")," that\ncan be converted to ",(0,s.kt)("inlineCode",{parentName:"p"},"Uint8Array")," and passed to ",(0,s.kt)("inlineCode",{parentName:"p"},"XLSX.read"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'fetch(url).then(function(res) {\n  /* get the data as a Blob */\n  if(!res.ok) throw new Error("fetch failed");\n  return res.arrayBuffer();\n}).then(function(ab) {\n  /* parse the data when it is received */\n  var data = new Uint8Array(ab);\n  var workbook = XLSX.read(data, {type:"array"});\n\n  /* DO SOMETHING WITH workbook HERE */\n});\n')),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("b",null,"Live Download demo")," (click to show)"),(0,s.kt)("p",null,"This demo uses ",(0,s.kt)("inlineCode",{parentName:"p"},"fetch")," to download ",(0,s.kt)("a",{parentName:"p",href:"https://sheetjs.com/pres.numbers"},"https://sheetjs.com/pres.numbers")," and show\nthe data in an HTML table."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live",live:!0},'function SheetJSFetchDL() {\n  const [html, setHTML] = React.useState("");\n\n  /* Fetch and update HTML */\n  React.useEffect(async() => {\n    /* Fetch file */\n    const res = await fetch("https://sheetjs.com/pres.numbers");\n    const ab = await res.arrayBuffer();\n\n    /* Parse file */\n    const wb = XLSX.read(ab);\n    const ws = wb.Sheets[wb.SheetNames[0]];\n\n    /* Generate HTML */\n    setHTML(XLSX.utils.sheet_to_html(ws));\n  }, []);\n\n  return (<div dangerouslySetInnerHTML={{__html: html}}/>);\n}\n'))),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"fetch")," takes a second parameter which allows for setting POST request body:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'// assuming `fdata` is a FormData object from "Uploading Binary Data" section\nfetch("/upload", { method: "POST", body: fdata });\n')),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("b",null,"Live Upload demo")," (click to show)"),(0,s.kt)("p",null,"This demo uses ",(0,s.kt)("inlineCode",{parentName:"p"},"fetch")," to upload data to ",(0,s.kt)("a",{parentName:"p",href:"https://s2c.sheetjs.com"},"https://s2c.sheetjs.com"),".  It will parse\nthe workbook and return an HTML table."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live",live:!0},'function SheetJSFetchUL() {\n  const [html, setHTML] = React.useState("");\n  const [sz, setSz] = React.useState(0);\n  const csv = "a,b,c\\n1,2,3";\n  /* Fetch and update HTML */\n  const xport = React.useCallback(async(e) => {\n    /* Make Workbook from CSV */\n    const wb = XLSX.read(csv, { type: "string" });\n    const data = XLSX.write(wb, {bookType: \'xlsx\', type: \'array\'});\n\n    /* Make FormData */\n    setSz(data.length || data.byteLength);\n    const fdata = new FormData();\n    fdata.append(\'file\', new File([data], \'sheetjs.xlsx\'));\n\n    /* Upload */\n    const url = "https://s2c.sheetjs.com";\n    const res = await fetch(url, {method:"POST", body: fdata});\n\n    /* Set HTML */\n    setHTML((await res.text()));\n  });\n\n  return (<pre>\n    <b>CSV Data</b>\n    <div>{csv}</div>\n    {sz ? (<>\n      <b>Generated file size: {sz} bytes</b>\n      <div dangerouslySetInnerHTML={{__html: html}}/>\n    </>) : (<button onClick={xport}><b>Export and Upload!</b></button>)}\n  </pre>);\n}\n'))),(0,s.kt)("h3",{id:"wrapper-libraries"},"Wrapper Libraries"),(0,s.kt)("p",null,"Before ",(0,s.kt)("inlineCode",{parentName:"p"},"fetch")," shipped with browsers, there were various wrapper libraries to\nsimplify ",(0,s.kt)("inlineCode",{parentName:"p"},"XMLHttpRequest"),".  Due to limitations with ",(0,s.kt)("inlineCode",{parentName:"p"},"fetch"),", these libraries\nare still relevant."),(0,s.kt)("h4",{id:"axios"},"axios"),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"axios")," library presents a Promise interface. Setting ",(0,s.kt)("inlineCode",{parentName:"p"},"responseType")," to\n",(0,s.kt)("inlineCode",{parentName:"p"},"arraybuffer")," ensures the return type is an ArrayBuffer:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"async function workbook_dl_axios(url) {\n  const res = await axios(url, {responseType:'arraybuffer'});\n  const workbook = XLSX.read(res.data);\n  return workbook;\n}\n")),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("b",null,"Live Download demo")," (click to show)"),(0,s.kt)("p",null,"This demo uses ",(0,s.kt)("inlineCode",{parentName:"p"},"axios")," to download ",(0,s.kt)("a",{parentName:"p",href:"https://sheetjs.com/pres.numbers"},"https://sheetjs.com/pres.numbers")," and show\nthe data in an HTML table."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live",live:!0},'function SheetJSAxiosDL() {\n  const [html, setHTML] = React.useState("");\n\n  /* Fetch and update HTML */\n  React.useEffect(async() => {\n    /* Fetch file */\n    const res = await axios("https://sheetjs.com/pres.numbers", {responseType: "arraybuffer"});\n\n    /* Parse file */\n    const wb = XLSX.read(res.data);\n    const ws = wb.Sheets[wb.SheetNames[0]];\n\n    /* Generate HTML */\n    setHTML(XLSX.utils.sheet_to_html(ws));\n  }, []);\n\n  return (<div dangerouslySetInnerHTML={{__html: html}}/>);\n}\n'))),(0,s.kt)("p",null,"Uploading form data is nearly identical to the ",(0,s.kt)("inlineCode",{parentName:"p"},"fetch")," example:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'axios("/upload", { method: "POST", data: fdata });\n')),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("b",null,"Live Upload demo")," (click to show)"),(0,s.kt)("p",null,"This demo uses ",(0,s.kt)("inlineCode",{parentName:"p"},"axios")," to upload data to ",(0,s.kt)("a",{parentName:"p",href:"https://s2c.sheetjs.com"},"https://s2c.sheetjs.com"),".  It will parse\nthe workbook and return an HTML table."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live",live:!0},'function SheetJSAxiosUL() {\n  const [html, setHTML] = React.useState("");\n  const [sz, setSz] = React.useState(0);\n  const csv = "a,b,c\\n1,2,3";\n  /* Fetch and update HTML */\n  const xport = React.useCallback(async() => {\n    /* Make Workbook from CSV */\n    const wb = XLSX.read(csv, { type: "string" });\n\n    /* Make FormData */\n    const data = XLSX.write(wb, {bookType: \'xlsx\', type: \'array\'});\n    setSz(data.length || data.byteLength);\n    const fdata = new FormData();\n    fdata.append(\'file\', new File([data], \'sheetjs.xlsx\'));\n\n    /* Upload */\n    const url = "https://s2c.sheetjs.com";\n    const res = await axios(url, {method:"POST", data: fdata});\n\n    /* Set HTML */\n    setHTML(res.data);\n  });\n\n  return (<pre>\n    <b>CSV Data</b>\n    <div>{csv}</div>\n    {sz ? (<>\n      <b>Generated file size: {sz} bytes</b>\n      <div dangerouslySetInnerHTML={{__html: html}}/>\n    </>) : (<button onClick={xport}><b>Export and Upload!</b></button>)}\n  </pre>);\n}\n'))),(0,s.kt)("h4",{id:"superagent"},"superagent"),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"superagent")," library usage mirrors XHR:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"/* set up an async GET request with superagent */\nsuperagent.get(url).responseType('arraybuffer').end(function(err, res) {\n  /* parse the data when it is received */\n  var data = new Uint8Array(res.body);\n  var workbook = XLSX.read(data, {type:\"array\"});\n\n  /* DO SOMETHING WITH workbook HERE */\n});\n")),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("b",null,"Live Download demo")," (click to show)"),(0,s.kt)("p",null,"This demo uses ",(0,s.kt)("inlineCode",{parentName:"p"},"superagent")," to download ",(0,s.kt)("a",{parentName:"p",href:"https://sheetjs.com/pres.numbers"},"https://sheetjs.com/pres.numbers")," and\nshow the data in an HTML table."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live",live:!0},'function SheetJSSuperAgentDL() {\n  const [html, setHTML] = React.useState("");\n\n  /* Fetch and update HTML */\n  React.useEffect(async() => {\n    /* Fetch file */\n    superagent\n      .get("https://sheetjs.com/pres.numbers")\n      .responseType("arraybuffer")\n      .end((err, res) => {\n        /* Parse file */\n        const wb = XLSX.read(res.body);\n        const ws = wb.Sheets[wb.SheetNames[0]];\n\n        /* Generate HTML */\n        setHTML(XLSX.utils.sheet_to_html(ws));\n      });\n  }, []);\n\n  return (<div dangerouslySetInnerHTML={{__html: html}}/>);\n}\n'))),(0,s.kt)("p",null,"The upload portion only differs in the actual request command:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'/* send data (fd is the FormData object) */\nsuperagent.post("/upload").send(fd);\n')),(0,s.kt)("details",null,(0,s.kt)("summary",null,(0,s.kt)("b",null,"Live Upload demo")," (click to show)"),(0,s.kt)("p",null,"This demo uses ",(0,s.kt)("inlineCode",{parentName:"p"},"superagent")," to upload data to ",(0,s.kt)("a",{parentName:"p",href:"https://s2c.sheetjs.com"},"https://s2c.sheetjs.com"),".  It will\nparse the workbook and return an HTML table."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live",live:!0},"function SheetJSSuperAgentUL() {\n  const [html, setHTML] = React.useState(\"\");\n  const [sz, setSz] = React.useState(0);\n  const csv = \"a,b,c\\n1,2,3\";\n  /* Fetch and update HTML */\n  const xport = React.useCallback(async() => {\n    /* Make Workbook from CSV */\n    const wb = XLSX.read(csv, { type: \"string\" });\n\n    /* Make FormData */\n    const data = XLSX.write(wb, {bookType: 'xlsx', type: 'array'});\n    setSz(data.length || data.byteLength);\n    const fdata = new FormData();\n    fdata.append('file', new File([data], 'sheetjs.xlsx'));\n\n    /* Upload */\n    const url = \"https://s2c.sheetjs.com\";\n    superagent.post(url).send(fdata).end((err, res) => {\n      /* Set HTML */\n      setHTML(res.text);\n    });\n\n  });\n\n  return (<pre>\n    <b>CSV Data</b>\n    <div>{csv}</div>\n    {sz ? (<>\n      <b>Generated file size: {sz} bytes</b>\n      <div dangerouslySetInnerHTML={{__html: html}}/>\n    </>) : (<button onClick={xport}><b>Export and Upload!</b></button>)}\n  </pre>);\n}\n"))),(0,s.kt)("h2",{id:"nodejs-demos"},"NodeJS Demos"),(0,s.kt)("p",null,"This demo focuses on a number of strategies. Some of these demos were written\nbefore NodeJS added ",(0,s.kt)("inlineCode",{parentName:"p"},"fetch"),"."),(0,s.kt)("h3",{id:"request"},"request"),(0,s.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},(0,s.kt)("inlineCode",{parentName:"p"},"request")," has been deprecated and should only be used in legacy deployments."))),(0,s.kt)("p",null,"Setting the option ",(0,s.kt)("inlineCode",{parentName:"p"},"encoding: null")," passes raw buffers:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"var XLSX = require('xlsx'), request = require('request');\nvar url = 'https://sheetjs.com/pres.numbers';\n\n/* call `request` with the option `encoding: null` */\n// highlight-next-line\nrequest(url, {encoding: null}, function(err, res, data) {\n  if(err || res.statusCode !== 200) return;\n\n  /* if the request was succesful, parse the data */\n  // highlight-next-line\n  var wb = XLSX.read(data);\n\n  /* print the first worksheet to console */\n  var ws = wb.Sheets[wb.SheetNames[0]];\n  console.log(XLSX.utils.sheet_to_csv(ws, {blankrows:false}));\n});\n")))}m.isMDXComponent=!0}}]);