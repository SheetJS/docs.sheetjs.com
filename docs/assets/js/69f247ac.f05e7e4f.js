"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4994],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),u=p(n),c=r,h=u["".concat(l,".").concat(c)]||u[c]||m[c]||o;return n?a.createElement(h,s(s({ref:t},d),{},{components:n})):a.createElement(h,s({ref:t},d))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var p=2;p<o;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(7294),r=n(4334);const o="tabItem_Ymn6";function s(e){let{children:t,hidden:n,className:s}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o,s),hidden:n},t)}},5488:(e,t,n)=>{n.d(t,{Z:()=>c});var a=n(7462),r=n(7294),o=n(4334),s=n(2389),i=n(7392),l=n(7094),p=n(2466);const d="tabList__CuJ",m="tabItem_LNqP";function u(e){var t,n;const{lazy:s,block:u,defaultValue:c,values:h,groupId:k,className:b}=e,f=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),w=null!=h?h:f.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),g=(0,i.l)(w,((e,t)=>e.value===t.value));if(g.length>0)throw new Error('Docusaurus error: Duplicate values "'+g.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const N=null===c?c:null!=(t=null!=c?c:null==(n=f.find((e=>e.props.default)))?void 0:n.props.value)?t:f[0].props.value;if(null!==N&&!w.some((e=>e.value===N)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+N+'" but none of its children has the corresponding value. Available values are: '+w.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:x,setTabGroupChoices:v}=(0,l.U)(),[y,S]=(0,r.useState)(N),T=[],{blockElementScrollPositionUntilNextRender:X}=(0,p.o5)();if(null!=k){const e=x[k];null!=e&&e!==y&&w.some((t=>t.value===e))&&S(e)}const C=e=>{const t=e.currentTarget,n=T.indexOf(t),a=w[n].value;a!==y&&(X(t),S(a),null!=k&&v(k,String(a)))},j=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{var a;const t=T.indexOf(e.currentTarget)+1;n=null!=(a=T[t])?a:T[0];break}case"ArrowLeft":{var r;const t=T.indexOf(e.currentTarget)-1;n=null!=(r=T[t])?r:T[T.length-1];break}}null==(t=n)||t.focus()};return r.createElement("div",{className:(0,o.Z)("tabs-container",d)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":u},b)},w.map((e=>{let{value:t,label:n,attributes:s}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:y===t?0:-1,"aria-selected":y===t,key:t,ref:e=>T.push(e),onKeyDown:j,onFocus:C,onClick:C},s,{className:(0,o.Z)("tabs__item",m,null==s?void 0:s.className,{"tabs__item--active":y===t})}),null!=n?n:t)}))),s?(0,r.cloneElement)(f.filter((e=>e.props.value===y))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},f.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==y})))))}function c(e){const t=(0,s.Z)();return r.createElement(u,(0,a.Z)({key:String(t)},e))}},9628:(e,t,n)=>{n.d(t,{Z:()=>a});const a="0.18.10"},8469:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>p,default:()=>h,frontMatter:()=>l,metadata:()=>d,toc:()=>u});var a=n(7462),r=(n(7294),n(3905)),o=n(9628),s=n(5488),i=n(5162);const l={sidebar_position:5},p="Data Export",d={unversionedId:"solutions/output",id:"solutions/output",title:"Data Export",description:"Writing Workbooks",source:"@site/docs/06-solutions/05-output.md",sourceDirName:"06-solutions",slug:"/solutions/output",permalink:"/docs/solutions/output",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Data Processing",permalink:"/docs/solutions/processing"},next:{title:"Common Spreadsheet Format",permalink:"/docs/csf/"}},m={},u=[{value:"Writing Workbooks",id:"writing-workbooks",level:2},{value:"API",id:"api",level:3},{value:"Examples",id:"examples",level:4},{value:"Example: Local File",id:"example-local-file",level:3},{value:"Example: Server Responses",id:"example-server-responses",level:3},{value:"Example: Remote File",id:"example-remote-file",level:3},{value:"Generating JSON and JS Data",id:"generating-json-and-js-data",level:2},{value:"API",id:"api-1",level:3},{value:"Examples",id:"examples-1",level:4},{value:"Example: Data Grids",id:"example-data-grids",level:3},{value:"Example: Data Loading",id:"example-data-loading",level:3},{value:"Generating HTML Tables",id:"generating-html-tables",level:2},{value:"API",id:"api-2",level:4},{value:"Examples",id:"examples-2",level:4},{value:"Generating Single-Worksheet Snapshots",id:"generating-single-worksheet-snapshots",level:2},{value:"API",id:"api-3",level:4},{value:"Streaming Write",id:"streaming-write",level:2}],c={toc:u};function h(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"data-export"},"Data Export"),(0,r.kt)("h2",{id:"writing-workbooks"},"Writing Workbooks"),(0,r.kt)("h3",{id:"api"},"API"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Generate spreadsheet bytes (file) from data")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var data = XLSX.write(workbook, opts);\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"write")," method attempts to package data from the workbook into a file in\nmemory.  By default, XLSX files are generated, but that can be controlled with\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"bookType")," property of the ",(0,r.kt)("inlineCode",{parentName:"p"},"opts")," argument.  Based on the ",(0,r.kt)("inlineCode",{parentName:"p"},"type"),' option,\nthe data can be stored as a "binary string", JS string, ',(0,r.kt)("inlineCode",{parentName:"p"},"Uint8Array")," or Buffer."),(0,r.kt)("p",null,"The second ",(0,r.kt)("inlineCode",{parentName:"p"},"opts")," argument is required.  ",(0,r.kt)("a",{parentName:"p",href:"../api/write-options"},'"Writing Options"'),"\ncovers the supported properties and behaviors."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Generate and attempt to save file")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"XLSX.writeFile(workbook, filename, opts);\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"writeFile")," method packages the data and attempts to save the new file.  The\nexport file format is determined by the extension of ",(0,r.kt)("inlineCode",{parentName:"p"},"filename")," (",(0,r.kt)("inlineCode",{parentName:"p"},"SheetJS.xlsx"),"\nsignals XLSX export, ",(0,r.kt)("inlineCode",{parentName:"p"},"SheetJS.xlsb")," signals XLSB export, etc)."),(0,r.kt)("p",null,"The second ",(0,r.kt)("inlineCode",{parentName:"p"},"opts")," argument is optional.  ",(0,r.kt)("a",{parentName:"p",href:"../api/write-options"},'"Writing Options"'),"\ncovers the supported properties and behaviors."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Generate and attempt to save an XLSX file")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"XLSX.writeFileXLSX(workbook, filename, opts);\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"writeFile")," method embeds a number of different export functions.  This is\ngreat for developer experience but not amenable to tree shaking using the\ncurrent developer tools.  When only XLSX exports are needed, this method avoids\nreferencing the other export functions."),(0,r.kt)("p",null,"The second ",(0,r.kt)("inlineCode",{parentName:"p"},"opts")," argument is optional.  ",(0,r.kt)("a",{parentName:"p",href:"../api/write-options"},'"Writing Options"'),"\ncovers the supported properties and behaviors."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"writeFile")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"writeFileXLSX")," methods uses platform-specific APIs to save\nfiles. The APIs do not generally provide feedback on whether files were created.")),(0,r.kt)("h4",{id:"examples"},"Examples"),(0,r.kt)("p",null,"Here are a few common scenarios (click on each subtitle to see the code)."),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"../demos"},"demos")," cover special deployments in more detail."),(0,r.kt)("h3",{id:"example-local-file"},"Example: Local File"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"XLSX.writeFile")," supports writing local files in platforms like NodeJS. In other\nplatforms like React Native, ",(0,r.kt)("inlineCode",{parentName:"p"},"XLSX.write")," should be called with file data."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"browser",label:"Browser",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"XLSX.writeFile")," wraps a few techniques for triggering a file save:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"URL")," browser API creates an object URL for the file, which the library uses\nby creating a link and forcing a click. It is supported in modern browsers."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"msSaveBlob")," is an IE10+ API for triggering a file save."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"IE_FileSave")," uses VBScript and ActiveX to write a file in IE6+ for Windows\nXP and Windows 7.  The shim must be included in the containing HTML page.")),(0,r.kt)("p",null,"There is no standard way to determine if the actual file has been downloaded."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/* output format determined by filename */\nXLSX.writeFile(workbook, "out.xlsb");\n/* at this point, out.xlsb will have been downloaded */\n')),(0,r.kt)("admonition",{title:"Web Workers",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"None of the file writing APIs work from Web Workers.  To generate a file:"),(0,r.kt)("p",{parentName:"admonition"},"1) use ",(0,r.kt)("inlineCode",{parentName:"p"},"XLSX.write")," with type ",(0,r.kt)("inlineCode",{parentName:"p"},"array")," to generate a ",(0,r.kt)("inlineCode",{parentName:"p"},"Uint8Array"),":"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// in the web worker, generate the XLSX file as a Uint8Array\nconst u8 = XLSX.write(workbook, { type: "array", bookType: "xlsx" });\n')),(0,r.kt)("p",{parentName:"admonition"},"2) send the data back to the main thread:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// in the web worker, send the generated data back to the main thread\npostMessage({t: "export", v: u8 });\n')),(0,r.kt)("p",{parentName:"admonition"},"3) from the main thread, add an event listener to write to file:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// in the main page\nworker.addEventListener(\'message\', function(e) {\n  if(e && e.data && e.data.t == "export") {\n    e.stopPropagation();\n    e.preventDefault();\n    // data will be the Uint8Array from the worker\n    const data = e.data.v;\n\n    var blob = new Blob([data], {type:"application/octet-stream"});\n    var url = URL.createObjectURL(blob);\n    var a = document.createElement("a");\n    a.download = "SheetJSXPort.xlsx";\n    a.href = url;\n    document.body.appendChild(a);\n    a.click();\n  }\n});\n'))),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("b",null,"SWF workaround for Windows 95+")," (click to show)"),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"Each moving part in this solution has been deprecated years ago:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Adobe stopped supporting Flash Player at the end of 2020"),(0,r.kt)("li",{parentName:"ul"},"Microsoft stopped supporting IE8 in 2019 and stopped supporting IE9 in 2020"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Downloadify")," support ended in 2010 and ",(0,r.kt)("inlineCode",{parentName:"li"},"SWFObject")," support ended in 2016")),(0,r.kt)("p",{parentName:"admonition"},'New projects should strongly consider requiring modern browsers.  This info is\nprovided on an "as is" basis and there is no realistic way to provide support\ngiven that every related vendor stopped providing support for their software.')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"XLSX.writeFile")," techniques work for most modern browsers as well as older IE.\nFor much older browsers, there are workarounds implemented by wrapper libraries."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/dcneiner/downloadify"},(0,r.kt)("inlineCode",{parentName:"a"},"Downloadify"))," uses a Flash SWF button\nto generate local files, suitable for environments where ActiveX is unavailable:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'Downloadify.create(id,{\n  /* other options are required! read the downloadify docs for more info */\n  filename: "test.xlsx",\n  data: function() { return XLSX.write(wb, {bookType:"xlsx", type:"base64"}); },\n  append: false,\n  dataType: "base64"\n});\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SheetJS/SheetJS/tree/master/demos/oldie/"},(0,r.kt)("inlineCode",{parentName:"a"},"oldie")," demo")," shows an IE-compatible fallback scenario."))),(0,r.kt)(i.Z,{value:"nodejs",label:"NodeJS",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"writeFile")," uses ",(0,r.kt)("inlineCode",{parentName:"p"},"fs.writeFileSync")," under the hood:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'var XLSX = require("xlsx");\n\n/* output format determined by filename */\nXLSX.writeFile(workbook, "out.xlsb");\n')),(0,r.kt)("p",null,"For Node ESM, ",(0,r.kt)("inlineCode",{parentName:"p"},"fs")," must be loaded manually:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import * as fs from "fs";\nimport { writeFile, set_fs } from "xlsx/xlsx.mjs";\nset_fs(fs);\n\n/* output format determined by filename */\nwriteFile(workbook, "out.xlsb");\n'))),(0,r.kt)(i.Z,{value:"bun",label:"Bun",mdxType:"TabItem"},(0,r.kt)("p",null,"As with Node ESM, ",(0,r.kt)("inlineCode",{parentName:"p"},"fs")," must be loaded manually:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import * as fs from "fs";\nimport { writeFile, set_fs } from "xlsx/xlsx.mjs";\nset_fs(fs);\n\n/* output format determined by filename */\nwriteFile(workbook, "out.xlsb");\n'))),(0,r.kt)(i.Z,{value:"deno",label:"Deno",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"writeFile")," uses ",(0,r.kt)("inlineCode",{parentName:"p"},"Deno.writeFileSync")," under the hood:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// @deno-types="https://cdn.sheetjs.com/xlsx-'+o.Z+"/package/types/index.d.ts\"\nimport * as XLSX from 'https://cdn.sheetjs.com/xlsx-"+o.Z+'/package/xlsx.mjs\';\n\nXLSX.writeFile(workbook, "test.xlsx");')),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Applications writing files must be invoked with the ",(0,r.kt)("inlineCode",{parentName:"p"},"--allow-write")," flag."))),(0,r.kt)(i.Z,{value:"electron",label:"Electron",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"writeFile")," can be used in the renderer process:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/* From the renderer process */\nvar XLSX = require("xlsx");\n\nXLSX.writeFile(workbook, "out.xlsb");\n')),(0,r.kt)("p",null,"Electron APIs have changed over time.  The ",(0,r.kt)("a",{parentName:"p",href:"../demos/desktop#electron"},(0,r.kt)("inlineCode",{parentName:"a"},"electron")," demo"),"\nshows a complete example and details the required version-specific settings.")),(0,r.kt)(i.Z,{value:"reactnative",label:"React Native",mdxType:"TabItem"},(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"React Native does not provide a way to write files to the filesystem.  A\nseparate third-party library must be used."),(0,r.kt)("p",{parentName:"admonition"},"Since React Native internals change between releases, libraries may only work\nwith specific versions of React Native.  Project documentation should be\nconsulted before picking a library.")),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SheetJS/SheetJS/tree/master/demos/react"},(0,r.kt)("inlineCode",{parentName:"a"},"react")," demo")," includes a sample React Native app."),(0,r.kt)("p",null,"The following libraries have been tested:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://npm.im/react-native-file-access"},(0,r.kt)("inlineCode",{parentName:"a"},"react-native-file-access")))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"base64")," encoding accepts Base64 strings compatible with the ",(0,r.kt)("inlineCode",{parentName:"p"},"binary")," type:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import * as XLSX from "xlsx";\nimport { Dirs, FileSystem } from "react-native-file-access";\nconst DDP = Dirs.DocumentDir + "/";\n\nconst b64 = XLSX.write(workbook, {type:\'base64\', bookType:"xlsx"});\n/* b64 is a base64 string */\nawait FileSystem.writeFile(DDP + "sheetjs.xlsx", b64, "base64");\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://npm.im/react-native-fs"},(0,r.kt)("inlineCode",{parentName:"a"},"react-native-fs")))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ascii")," encoding accepts binary strings compatible with the ",(0,r.kt)("inlineCode",{parentName:"p"},"binary")," type:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import * as XLSX from "xlsx";\nimport { writeFile, DocumentDirectoryPath } from "react-native-fs";\nconst DDP = DocumentDirectoryPath + "/";\n\nconst bstr = XLSX.write(workbook, {type:\'binary\', bookType:"xlsx"});\n/* bstr is a binary string */\nawait writeFile(DDP + "sheetjs.xlsx", bstr, "ascii");\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/expo-file-system"},(0,r.kt)("inlineCode",{parentName:"a"},"expo-file-system")))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"FileSystem.EncodingType.Base64")," encoding accepts Base64 strings:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import * as XLSX from "xlsx";\nimport * as FileSystem from \'expo-file-system\';\nconst DDP = FileSystem.documentDirectory;\n\nconst b64 = XLSX.write(workbook, {type:\'base64\', bookType:"xlsx"});\n/* b64 is a base64 string */\nawait FileSystem.writeAsStringAsync(DDP + "sheetjs.xlsx", b64, { encoding: FileSystem.EncodingType.Base64 });\n'))),(0,r.kt)(i.Z,{value:"extendscript",label:"Photoshop",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"writeFile")," wraps the ",(0,r.kt)("inlineCode",{parentName:"p"},"File")," logic in Photoshop and other ExtendScript targets.\nThe specified path should be an absolute path:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'#include "xlsx.extendscript.js"\n\n/* Ask user to select path */\nvar thisFile = File.saveDialog("Select an output file", "*.xlsx;*.xls");\n/* output format determined by filename */\nXLSX.writeFile(workbook, thisFile.absoluteURI);\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"../demos/extendscript"},(0,r.kt)("inlineCode",{parentName:"a"},"extendscript")," demo")," includes a more complex example.")),(0,r.kt)(i.Z,{value:"headless",label:"Headless",mdxType:"TabItem"},(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"../demos/headless"},(0,r.kt)("inlineCode",{parentName:"a"},"headless")," demo")," includes complete\nexamples of converting HTML TABLE elements to XLSB workbooks using Puppeteer\nand other headless automation tools."),(0,r.kt)("p",null,"Headless browsers may not have access to the filesystem, so ",(0,r.kt)("inlineCode",{parentName:"p"},"XLSX.writeFile"),"\nmay fail.  It is strongly recommended to generate the file bytes in the browser\ncontext, send the bytes to the automation context, and write from automation."),(0,r.kt)("p",null,"Puppeteer and Playwright are NodeJS modules that support binary strings:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/* from the browser context */\nvar bin = XLSX.write(workbook, { type:"binary", bookType: "xlsb" });\n\n/* from the automation context */\nfs.writeFileSync("SheetJSansHead.xlsb", bin, { encoding: "binary" });\n')),(0,r.kt)("p",null,"PhantomJS ",(0,r.kt)("inlineCode",{parentName:"p"},"fs.write")," supports writing files from the main process.  The mode\n",(0,r.kt)("inlineCode",{parentName:"p"},"wb")," supports binary strings:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/* from the browser context */\nvar bin = XLSX.write(workbook, { type:"binary", bookType: "xlsb" });\n\n/* from the automation context */\nfs.write("SheetJSansHead.xlsb", bin, "wb");\n')))),(0,r.kt)("h3",{id:"example-server-responses"},"Example: Server Responses"),(0,r.kt)("p",null,"This example focuses on responses to network requests in a server-side platform\nlike NodeJS. While files can be generated in the web browser, server-side file\ngeneration allows for exact audit trails and has better mobile user support."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Production deployments should use a server framework like ExpressJS.  These\nsnippets use low-level APIs for illustration purposes.")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Content-Type")," header should be set to ",(0,r.kt)("inlineCode",{parentName:"p"},"application/vnd.ms-excel")," for Excel\nexports including XLSX. The default ",(0,r.kt)("inlineCode",{parentName:"p"},"application/octet-stream")," can be used, but\niOS will not automatically suggest to open files in Numbers or Excel for iOS"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Content-Disposition")," header instructs browsers to download the response\ninto a file.  The header can also include the desired file name."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"nodejs",label:"NodeJS",mdxType:"TabItem"},(0,r.kt)("p",null,"NodeJS ",(0,r.kt)("inlineCode",{parentName:"p"},"http.ServerResponse#end")," can accept ",(0,r.kt)("inlineCode",{parentName:"p"},"Buffer")," objects. ",(0,r.kt)("inlineCode",{parentName:"p"},"XLSX.write")," with\n",(0,r.kt)("inlineCode",{parentName:"p"},"buffer")," type returns ",(0,r.kt)("inlineCode",{parentName:"p"},"Buffer")," objects."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"/* generate Buffer */\nconst buf = XLSX.write(wb, { type:\"buffer\", bookType:\"xlsx\" });\n\n/* prepare response headers */\nres.statusCode = 200;\nres.setHeader('Content-Disposition', 'attachment; filename=\"SheetJSNode.xlsx\"');\nres.setHeader('Content-Type', 'application/vnd.ms-excel');\nres.end(buf);\n")),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("b",null,"Complete Example")," (click to show)"),(0,r.kt)("p",null,"Install the library with"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i https://cdn.sheetjs.com/xlsx-latest/xlsx-latest.tgz\n")),(0,r.kt)("p",null,"Save the following script to ",(0,r.kt)("inlineCode",{parentName:"p"},"node.js")," and run with ",(0,r.kt)("inlineCode",{parentName:"p"},"node node.js"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="node.js"',title:'"node.js"'},"const http = require('http');\nconst XLSX = require('xlsx');\n\nconst hostname = '127.0.0.1';\nconst port = 7262;\n\n/* fixed sample worksheet */\nconst wb = XLSX.utils.book_new();\nXLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet([\n  [\"a\",\"b\",\"c\"], [1,2,3]\n]), \"Sheet1\");\n\nconst server = http.createServer((req, res) => {\n  const buf = XLSX.write(wb, { type:\"buffer\", bookType:\"xlsx\" });\n  res.statusCode = 200;\n  res.setHeader('Content-Disposition', 'attachment; filename=\"SheetJSNode.xlsx\"');\n  res.setHeader('Content-Type', 'application/vnd.ms-excel');\n  res.end(buf);\n});\n\nserver.listen(port, hostname, () => {\n  console.log(`Server running at http://${hostname}:${port}/`);\n});\n")))),(0,r.kt)(i.Z,{value:"deno",label:"Deno",mdxType:"TabItem"}),(0,r.kt)(i.Z,{value:"bun",label:"Bun",mdxType:"TabItem"},(0,r.kt)("p",null,"Bun responses are expected to be ",(0,r.kt)("inlineCode",{parentName:"p"},"Response")," objects. ",(0,r.kt)("inlineCode",{parentName:"p"},"XLSX.write")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"buffer"),"\ntype returns ",(0,r.kt)("inlineCode",{parentName:"p"},"Buffer")," objects that can be used in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Response")," constructor."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/* generate Buffer */\nconst buf = XLSX.write(wb, { type:"buffer", bookType:"xlsx" });\n/* return Response */\nreturn new Response(buf, {\n  headers: {\n    "Content-Type": "application/vnd.ms-excel",\n    "Content-Disposition": \'attachment; filename="SheetJSBun.xlsx"\'\n  }\n});\n')),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("b",null,"Complete Example")," (click to show)"),(0,r.kt)("p",null,"Download ",(0,r.kt)("a",{parentName:"p",href:"https://cdn.sheetjs.com/xlsx-latest/package/xlsx.mjs"},(0,r.kt)("inlineCode",{parentName:"a"},"xlsx.mjs")),".\nSave the following script to ",(0,r.kt)("inlineCode",{parentName:"p"},"bun.js")," and run with ",(0,r.kt)("inlineCode",{parentName:"p"},"bun bun.js"),".   Open a web\nbrowser and access ",(0,r.kt)("a",{parentName:"p",href:"http://localhost:7262"},"http://localhost:7262")," to download the exported workbook."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="bun.js"',title:'"bun.js"'},'import * as XLSX from "./xlsx.mjs";\n\n/* fixed sample worksheet */\nconst wb = XLSX.utils.book_new();\nXLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet([\n  ["a","b","c"], [1,2,3]\n]), "Sheet1");\n\nexport default {\n  port: 7262,\n  fetch(request) {\n    /* generate Buffer */\n    const buf = XLSX.write(wb, {type:"buffer", bookType:"xlsx"});\n    /* return Response */\n    return new Response(buf, {\n      headers: {\n        "Content-Type": "application/vnd.ms-excel",\n        "Content-Disposition": \'attachment; filename="SheetJSBun.xlsx"\'\n      }\n    });\n  },\n};\n'))))),(0,r.kt)("h3",{id:"example-remote-file"},"Example: Remote File"),(0,r.kt)("p",null,'This example focuses on uploading files ("Ajax" in browser parlance) using APIs\nlike ',(0,r.kt)("inlineCode",{parentName:"p"},"XMLHttpRequest")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"fetch")," as well as third-party libraries."),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"browser",label:"Browser",mdxType:"TabItem"},(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Some platforms like Azure and AWS will attempt to parse POST request bodies as\nUTF-8 strings before user code can see the data.  This will result in corrupt\ndata parsed by the server.  There are some workarounds, but the safest approach\nis to adjust the server process or Lambda function to accept Base64 strings.")),(0,r.kt)("p",null,"A complete example using XHR is ",(0,r.kt)("a",{parentName:"p",href:"../demos/network"},"included in the XHR demo"),", along\nwith examples for fetch and wrapper libraries.  This example assumes the server\ncan handle Base64-encoded files (see the demo for a basic nodejs server):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/* in this example, send a base64 string to the server */\nvar wbout = XLSX.write(workbook, { bookType: "xlsx", type: "base64" });\n\n/* prepare data for POST */\nvar formdata = new FormData();\nformdata.append("file", "test.xlsx"); // <-- server expects `file` to hold name\nformdata.append("data", wbout); // <-- `data` holds the base64-encoded data\n\n/* perform POST request */\nvar req = new XMLHttpRequest();\nreq.open("POST", "/upload", true);\nreq.send(formdata);\n')),(0,r.kt)("p",null,"For servers that do not parse POST request bodies as UTF-8 strings, a ",(0,r.kt)("inlineCode",{parentName:"p"},"Blob")," can\nbe generated from the ",(0,r.kt)("inlineCode",{parentName:"p"},"array")," output:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/* in this example, send a Blob to the server */\nvar wbout = XLSX.write(workbook, { bookType: "xlsx", type: "array" });\n\n/* prepare data for POST */\nvar blob = new Blob([new Uint8Array(wbout)], {type:"application/octet-stream"});\nvar formdata = new FormData();\nformdata.append("file", blob, "test.xlsx");\n\n/* perform POST request */\nfetch("/upload", { method: \'POST\', body: formdata });\n'))),(0,r.kt)(i.Z,{value:"nodejs",label:"NodeJS",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"XLSX.write")," with ",(0,r.kt)("inlineCode",{parentName:"p"},'type: "buffer"')," will generate a NodeJS ",(0,r.kt)("inlineCode",{parentName:"p"},"Buffer")," which can be\nused with standard NodeJS approaches for uploading data."),(0,r.kt)("p",null,"Node 17.5 and 18.0 have native support for fetch:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const XLSX = require("xlsx");\n\nconst buf = XLSX.write(workbook, { bookType: "xlsx", type: "buffer" });\nvar blob = new Blob([buf], {type:"application/octet-stream"});\nvar formdata = new FormData();\nformdata.append("file", blob, "test.xlsx");\n\n/* perform POST request */\nfetch("https://thisis.a.test/upload", { method: \'POST\', body: formdata });\n')))),(0,r.kt)("h2",{id:"generating-json-and-js-data"},"Generating JSON and JS Data"),(0,r.kt)("p",null,"JSON and JS data tend to represent single worksheets. The utility functions in\nthis section work with single worksheets."),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"../csf/general"},'"Common Spreadsheet Format"')," section describes\nthe object structure in more detail.  ",(0,r.kt)("inlineCode",{parentName:"p"},"workbook.SheetNames")," is an ordered list\nof the worksheet names.  ",(0,r.kt)("inlineCode",{parentName:"p"},"workbook.Sheets")," is an object whose keys are sheet\nnames and whose values are worksheet objects."),(0,r.kt)("p",null,'The "first worksheet" is stored at ',(0,r.kt)("inlineCode",{parentName:"p"},"workbook.Sheets[workbook.SheetNames[0]]"),"."),(0,r.kt)("h3",{id:"api-1"},"API"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Create an array of JS objects from a worksheet")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var jsa = XLSX.utils.sheet_to_json(worksheet, opts);\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Create an array of arrays of JS values from a worksheet")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var aoa = XLSX.utils.sheet_to_json(worksheet, {...opts, header: 1});\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"sheet_to_json")," utility function walks a workbook in row-major order,\ngenerating an array of objects.  The second ",(0,r.kt)("inlineCode",{parentName:"p"},"opts")," argument controls a number of\nexport decisions including the type of values (JS values or formatted text). The\n",(0,r.kt)("a",{parentName:"p",href:"../api/utilities#json"},'"JSON"')," section describes the argument in more detail."),(0,r.kt)("p",null,"By default, ",(0,r.kt)("inlineCode",{parentName:"p"},"sheet_to_json")," scans the first row and uses the values as headers.\nWith the ",(0,r.kt)("inlineCode",{parentName:"p"},"header: 1")," option, the function exports an array of arrays of values."),(0,r.kt)("h4",{id:"examples-1"},"Examples"),(0,r.kt)("h3",{id:"example-data-grids"},"Example: Data Grids"),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"Vanilla JS",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/myliang/x-spreadsheet"},(0,r.kt)("inlineCode",{parentName:"a"},"x-spreadsheet"))," is an interactive\ndata grid for previewing and modifying structured data in the web browser.  The\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SheetJS/SheetJS/tree/master/demos/xspreadsheet"},"demo"),"\nincludes a sample script with the ",(0,r.kt)("inlineCode",{parentName:"p"},"stox")," function for converting from\na workbook to x-spreadsheet.  Live Demo: ",(0,r.kt)("a",{parentName:"p",href:"https://oss.sheetjs.com/sheetjs/x-spreadsheet"},"https://oss.sheetjs.com/sheetjs/x-spreadsheet"))),(0,r.kt)(i.Z,{value:"react",label:"React",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://adazzle.github.io/react-data-grid"},(0,r.kt)("inlineCode",{parentName:"a"},"react-data-grid"))," is a data grid\nbuilt for React.  It uses two properties: ",(0,r.kt)("inlineCode",{parentName:"p"},"rows")," of data objects and ",(0,r.kt)("inlineCode",{parentName:"p"},"columns"),"\nwhich describe the columns.  For the purposes of massaging the data to fit the\n",(0,r.kt)("inlineCode",{parentName:"p"},"react-data-grid")," API it is easiest to start from an array of arrays."),(0,r.kt)("p",null,"This demo starts by fetching a remote file and using ",(0,r.kt)("inlineCode",{parentName:"p"},"XLSX.read")," to extract:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { useEffect, useState } from "react";\nimport DataGrid from "react-data-grid";\nimport { read, utils } from "xlsx";\n\nconst url = "https://oss.sheetjs.com/test_files/RkNumber.xls";\n\nexport default function App() {\n  const [columns, setColumns] = useState([]);\n  const [rows, setRows] = useState([]);\n  useEffect(() => {(async () => {\n    const wb = read(await (await fetch(url)).arrayBuffer());\n\n    /* use sheet_to_json with header: 1 to generate an array of arrays */\n    const data = utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], { header: 1 });\n\n    /* see react-data-grid docs to understand the shape of the expected data */\n    setColumns(data[0].map((r) => ({ key: r, name: r })));\n    setRows(data.slice(1).map((r) => r.reduce((acc, x, i) => {\n      acc[data[0][i]] = x;\n      return acc;\n    }, {})));\n  })(); });\n\n  return <DataGrid columns={columns} rows={rows} />;\n}\n'))),(0,r.kt)(i.Z,{value:"vue",label:"VueJS",mdxType:"TabItem"},(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://linmasahiro.github.io/vue3-table-lite/dist/"},(0,r.kt)("inlineCode",{parentName:"a"},"vue3-table-lite"))," is a\nsimple VueJS 3 data table.  It is featured in the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SheetJS/SheetJS/tree/master/demos/vue/modify/"},"VueJS demo"),"."))),(0,r.kt)("h3",{id:"example-data-loading"},"Example: Data Loading"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"../demos/ml"},'"Typed Arrays and ML"')," covers strategies for\ngenerating typed arrays and tensors from worksheet data."),(0,r.kt)("details",null,(0,r.kt)("summary",null,(0,r.kt)("b",null,"Populating a database (SQL or no-SQL)")," (click to show)"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SheetJS/SheetJS/tree/master/demos/database/"},(0,r.kt)("inlineCode",{parentName:"a"},"database")," demo"),"\nincludes examples of working with databases and query results.")),(0,r.kt)("h2",{id:"generating-html-tables"},"Generating HTML Tables"),(0,r.kt)("h4",{id:"api-2"},"API"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Generate HTML Table from Worksheet")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var html = XLSX.utils.sheet_to_html(worksheet);\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"sheet_to_html")," utility function generates HTML code based on the worksheet\ndata.  Each cell in the worksheet is mapped to a ",(0,r.kt)("inlineCode",{parentName:"p"},"<TD>")," element.  Merged cells\nin the worksheet are serialized by setting ",(0,r.kt)("inlineCode",{parentName:"p"},"colspan")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"rowspan")," attributes."),(0,r.kt)("h4",{id:"examples-2"},"Examples"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"sheet_to_html")," utility function generates HTML code that can be added to\nany DOM element by setting the ",(0,r.kt)("inlineCode",{parentName:"p"},"innerHTML"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'var container = document.getElementById("tavolo");\ncontainer.innerHTML = XLSX.utils.sheet_to_html(worksheet);\n')),(0,r.kt)("p",null,"Combining with ",(0,r.kt)("inlineCode",{parentName:"p"},"fetch"),", constructing a site from a workbook is straightforward:"),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"Vanilla JS",mdxType:"TabItem"},(0,r.kt)("p",null,"This example assigns the ",(0,r.kt)("inlineCode",{parentName:"p"},"innerHTML")," of a DIV element:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<body>\n  <style>TABLE { border-collapse: collapse; } TD { border: 1px solid; }</style>\n  <div id="tavolo"></div>\n  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"><\/script>\n  <script type="text/javascript">\n(async() => {\n  /* fetch and parse workbook -- see the fetch example for details */\n  const workbook = XLSX.read(await (await fetch("sheetjs.xlsx")).arrayBuffer());\n\n  let output = [];\n  /* loop through the worksheet names in order */\n  workbook.SheetNames.forEach(name => {\n\n    /* generate HTML from the corresponding worksheets */\n    const worksheet = workbook.Sheets[name];\n    const html = XLSX.utils.sheet_to_html(worksheet);\n\n    /* add a header with the title name followed by the table */\n    output.push(`<H3>${name}</H3>${html}`);\n  });\n  /* write to the DOM at the end */\n  tavolo.innerHTML = output.join("\\n");\n})();\n  <\/script>\n</body>\n'))),(0,r.kt)(i.Z,{value:"react",label:"React",mdxType:"TabItem"},(0,r.kt)("p",null,"It is generally recommended to use a React-friendly workflow, but it is possible\nto generate HTML and use it in React with ",(0,r.kt)("inlineCode",{parentName:"p"},"dangerouslySetInnerHTML"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import * as XLSX from 'xlsx';\n\nfunction Tabeller(props) {\n  /* the workbook object is the state */\n  const [workbook, setWorkbook] = React.useState(XLSX.utils.book_new());\n\n  /* fetch and update the workbook with an effect */\n  React.useEffect(() => { (async() => {\n    /* fetch and parse workbook -- see the fetch example for details */\n    const wb = XLSX.read(await (await fetch(\"sheetjs.xlsx\")).arrayBuffer());\n    setWorkbook(wb);\n  })(); });\n\n  return workbook.SheetNames.map(name => (<>\n    <h3>name</h3>\n    <div dangerouslySetInnerHTML={{\n      /* this __html mantra is needed to set the inner HTML */\n      __html: XLSX.utils.sheet_to_html(workbook.Sheets[name])\n    }} />\n  </>));\n}\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SheetJS/SheetJS/tree/master/demos/react"},(0,r.kt)("inlineCode",{parentName:"a"},"react")," demo")," includes more React examples.")),(0,r.kt)(i.Z,{value:"vue",label:"VueJS",mdxType:"TabItem"},(0,r.kt)("p",null,"It is generally recommended to use a VueJS-friendly workflow, but it is possible\nto generate HTML and use it in VueJS with the ",(0,r.kt)("inlineCode",{parentName:"p"},"v-html")," directive:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'import { read, utils } from \'xlsx\';\nimport { reactive } from \'vue\';\n\nconst S5SComponent = {\n  mounted() { (async() => {\n    /* fetch and parse workbook -- see the fetch example for details */\n    const workbook = read(await (await fetch("sheetjs.xlsx")).arrayBuffer());\n    /* loop through the worksheet names in order */\n    workbook.SheetNames.forEach(name => {\n      /* generate HTML from the corresponding worksheets */\n      const html = utils.sheet_to_html(workbook.Sheets[name]);\n      /* add to state */\n      this.wb.wb.push({ name, html });\n    });\n  })(); },\n  /* this state mantra is required for array updates to work */\n  setup() { return { wb: reactive({ wb: [] }) }; },\n  template: `\n  <div v-for="ws in wb.wb" :key="ws.name">\n    <h3>{{ ws.name }}</h3>\n    <div v-html="ws.html"></div>\n  </div>`\n};\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/SheetJS/SheetJS/tree/master/demos/vue"},(0,r.kt)("inlineCode",{parentName:"a"},"vuejs")," demo")," includes more React examples."))),(0,r.kt)("h2",{id:"generating-single-worksheet-snapshots"},"Generating Single-Worksheet Snapshots"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"sheet_to_*")," functions accept a worksheet object."),(0,r.kt)("h4",{id:"api-3"},"API"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Generate a CSV from a single worksheet")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var csv = XLSX.utils.sheet_to_csv(worksheet, opts);\n")),(0,r.kt)("p",null,'This snapshot is designed to replicate the "CSV UTF8 (',(0,r.kt)("inlineCode",{parentName:"p"},".csv"),')" output type.\n',(0,r.kt)("a",{parentName:"p",href:"../api/utilities#delimiter-separated-output"},'"Delimiter-Separated Output"')," describes the\nfunction and the optional ",(0,r.kt)("inlineCode",{parentName:"p"},"opts")," argument in more detail."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},'Generate "Text" from a single worksheet')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var txt = XLSX.utils.sheet_to_txt(worksheet, opts);\n")),(0,r.kt)("p",null,'This snapshot is designed to replicate the "UTF16 Text (',(0,r.kt)("inlineCode",{parentName:"p"},".txt"),')" output type.\n',(0,r.kt)("a",{parentName:"p",href:"../api/utilities#delimiter-separated-output"},'"Delimiter-Separated Output"')," describes the\nfunction and the optional ",(0,r.kt)("inlineCode",{parentName:"p"},"opts")," argument in more detail."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Generate a list of formulae from a single worksheet")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var fmla = XLSX.utils.sheet_to_formulae(worksheet);\n")),(0,r.kt)("p",null,"This snapshot generates an array of entries representing the embedded formulae.\nArray formulae are rendered in the form ",(0,r.kt)("inlineCode",{parentName:"p"},"range=formula")," while plain cells are\nrendered in the form ",(0,r.kt)("inlineCode",{parentName:"p"},"cell=formula or value"),".  String literals are prefixed with\nan apostrophe ",(0,r.kt)("inlineCode",{parentName:"p"},"'"),", consistent with Excel's formula bar display."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"../api/utilities#formulae-output"},'"Formulae Output"')," describes the function in more detail."),(0,r.kt)("h2",{id:"streaming-write"},"Streaming Write"),(0,r.kt)("p",null,"The streaming write functions are available in the ",(0,r.kt)("inlineCode",{parentName:"p"},"XLSX.stream")," object.  They\ntake the same arguments as the normal write functions but return a NodeJS\nReadable Stream."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"XLSX.stream.to_csv")," is the streaming version of ",(0,r.kt)("inlineCode",{parentName:"li"},"XLSX.utils.sheet_to_csv"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"XLSX.stream.to_html")," is the streaming version of ",(0,r.kt)("inlineCode",{parentName:"li"},"XLSX.utils.sheet_to_html"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"XLSX.stream.to_json")," is the streaming version of ",(0,r.kt)("inlineCode",{parentName:"li"},"XLSX.utils.sheet_to_json"),".")),(0,r.kt)(s.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"nodejs",label:"NodeJS",mdxType:"TabItem"},(0,r.kt)("p",null,"In a CommonJS context, NodeJS Streams immediately work with SheetJS.  This\nexample reads a worksheet passed as an argument to the script, pulls the first\nworksheet, converts to CSV and writes to ",(0,r.kt)("inlineCode",{parentName:"p"},"out.csv"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const XLSX = require("xlsx");\n\nconst workbook = XLSX.readFile(process.argv[2]);\nconst worksheet = workbook.Sheets[workbook.SheetNames[0]];\n// highlight-next-line\nconst stream = XLSX.stream.to_csv(worksheet);\n\nconst output_file_name = "out.csv";\n// highlight-next-line\nstream.pipe(fs.createWriteStream(output_file_name));\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"stream.to_json")," uses Object-mode streams. A ",(0,r.kt)("inlineCode",{parentName:"p"},"Transform")," stream can be used to\ngenerate a normal stream for streaming to a file or the screen:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/* to_json returns an object-mode stream */\n// highlight-next-line\nvar stream = XLSX.stream.to_json(worksheet, {raw:true});\n\n/* this Transform stream converts JS objects to text and prints to screen */\nvar conv = new Transform({writableObjectMode:true});\nconv._transform = function(obj, e, cb){ cb(null, JSON.stringify(obj) + "\\n"); };\nconv.pipe(process.stdout);\n\n// highlight-next-line\nstream.pipe(conv);\n'))),(0,r.kt)(i.Z,{value:"deno",label:"Deno",mdxType:"TabItem"},(0,r.kt)("p",null,"Deno does not support NodeJS streams in normal execution, so a wrapper is used.\nThis demo converts a worksheet to CSV and prints each row to the screen:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// @deno-types=\"https://cdn.sheetjs.com/xlsx-latest/package/types/index.d.ts\"\nimport {utils, stream, set_cptable} from 'https://cdn.sheetjs.com/xlsx-latest/package/xlsx.mjs';\n\n/* `Readable` will be compatible with how SheetJS uses `stream.Readable` */\nfunction NodeReadableCB(cb:(d:any)=>void) {\n  var rd = {\n    __done: false,\n    _read: function() {},\n    push: function(d: any) { if(!this.__done) cb(d); if(d == null) this.__done = true; },\n    resume: function pump() {for(var i = 0; i < 10000 && !this.__done; ++i) rd._read(); if(!rd.__done) setTimeout(pump, 0); }\n  };\n  return rd;\n}\nfunction NodeReadable(rd: any) { return function() { return rd; }; }\n/* The callback gets each CSV row.  It will be `null` when the stream is drained */\nconst rt = NodeReadableCB((d: any) => { if(d != null) console.log(d); });\nconst Readable = NodeReadable(rt);\nstream.set_readable(Readable);\n\n/* wire up and start the stream */\nconst rd = stream.to_csv(worksheet);\nrd.resume();\n")))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/sheetjs/sheetaki"},"https://github.com/sheetjs/sheetaki")," pipes write streams to nodejs response."))}h.isMDXComponent=!0}}]);